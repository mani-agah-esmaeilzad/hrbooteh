(()=>{var e={};e.id=3,e.ids=[3],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44958:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d}),r(44753),r(98158),r(68666);var t=r(23191),a=r(88716),l=r(37922),i=r.n(l),n=r(95231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(s,o);let d=["",{children:["admin",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,44753)),"/root/hrbooteh/src/app/admin/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,98158)),"/root/hrbooteh/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,68666)),"/root/hrbooteh/src/app/not-found.tsx"]}],c=["/root/hrbooteh/src/app/admin/page.tsx"],m="/admin/page",x={require:r,loadChunk:()=>Promise.resolve()},h=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/page",pathname:"/admin",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},23391:(e,s,r)=>{Promise.resolve().then(r.bind(r,34679))},86333:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(62881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},39730:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(62881).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},79635:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(62881).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},35047:(e,s,r)=>{"use strict";var t=r(77389);r.o(t,"useRouter")&&r.d(s,{useRouter:function(){return t.useRouter}})},34679:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>N});var t=r(10326),a=r(17577),l=r(35047),i=r(94001),n=r(85999),o=r(51223);let d=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{className:"relative w-full overflow-auto",children:t.jsx("table",{ref:r,className:(0,o.cn)("w-full caption-bottom text-sm",e),...s})}));d.displayName="Table";let c=a.forwardRef(({className:e,...s},r)=>t.jsx("thead",{ref:r,className:(0,o.cn)("[&_tr]:border-b",e),...s}));c.displayName="TableHeader";let m=a.forwardRef(({className:e,...s},r)=>t.jsx("tbody",{ref:r,className:(0,o.cn)("[&_tr:last-child]:border-0",e),...s}));m.displayName="TableBody",a.forwardRef(({className:e,...s},r)=>t.jsx("tfoot",{ref:r,className:(0,o.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s})).displayName="TableFooter";let x=a.forwardRef(({className:e,...s},r)=>t.jsx("tr",{ref:r,className:(0,o.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s}));x.displayName="TableRow";let h=a.forwardRef(({className:e,...s},r)=>t.jsx("th",{ref:r,className:(0,o.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));h.displayName="TableHead";let u=a.forwardRef(({className:e,...s},r)=>t.jsx("td",{ref:r,className:(0,o.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));u.displayName="TableCell",a.forwardRef(({className:e,...s},r)=>t.jsx("caption",{ref:r,className:(0,o.cn)("mt-4 text-sm text-muted-foreground",e),...s})).displayName="TableCaption";var p=r(29752),f=r(91664);let g=(0,r(62881).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);var b=r(86333),j=r(79635),y=r(39730);let N=()=>{let{user:e,token:s,loading:r}=(0,i.a)(),N=(0,l.useRouter)(),[v,w]=(0,a.useState)([]),[_,k]=(0,a.useState)(null),[A,P]=(0,a.useState)({}),[R,Z]=(0,a.useState)(!0),[S,C]=(0,a.useState)(!1),[T,M]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!r){if(!e||"admin"!==e.role){n.Am.error("Access Denied: You must be an administrator to view this page."),N.push("/"),Z(!1);return}(async()=>{try{let e=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${s}`}}),r=await e.json();e.ok?w(r.data):(M(r.error||"Failed to fetch users"),n.Am.error(r.error||"Failed to fetch users"))}catch(e){M(e.message||"An unexpected error occurred"),n.Am.error(e.message||"An unexpected error occurred")}finally{Z(!1)}})()}},[e,s,N,r]);let q=async e=>{C(!0),P({});try{let r=await fetch(`/api/admin/chats?userId=${e}`,{headers:{Authorization:`Bearer ${s}`}}),t=await r.json();r.ok?P(t.data):(M(t.error||"Failed to fetch chat history"),n.Am.error(t.error||"Failed to fetch chat history"))}catch(e){M(e.message||"An unexpected error occurred"),n.Am.error(e.message||"An unexpected error occurred")}finally{C(!1)}};return r||R?(0,t.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:[t.jsx(g,{className:"h-8 w-8 animate-spin text-blue-500"}),t.jsx("p",{className:"ml-2 text-gray-600",children:"Loading admin panel..."})]}):T?(0,t.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-red-50 text-red-700",children:[(0,t.jsxs)("p",{className:"text-lg font-semibold",children:["Error: ",T]}),t.jsx(f.z,{onClick:()=>N.push("/"),className:"mt-4",children:"Go to Home"})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)(f.z,{variant:"ghost",onClick:()=>N.push("/"),className:"flex items-center gap-2",children:[t.jsx(b.Z,{className:"h-4 w-4"})," Back to Home"]}),t.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Admin Panel"}),t.jsx("div",{className:"w-24"})," "]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)(p.Zb,{className:"md:col-span-1",children:[t.jsx(p.Ol,{children:(0,t.jsxs)(p.ll,{className:"flex items-center gap-2 text-lg",children:[t.jsx(j.Z,{className:"h-5 w-5 text-blue-600"})," Registered Users"]})}),t.jsx(p.aY,{className:"max-h-[70vh] overflow-y-auto",children:(0,t.jsxs)(d,{children:[t.jsx(c,{children:(0,t.jsxs)(x,{children:[t.jsx(h,{children:"Username"}),t.jsx(h,{children:"Email"}),t.jsx(h,{children:"Role"})]})}),t.jsx(m,{children:v.map(e=>(0,t.jsxs)(x,{onClick:()=>{k(e),q(e.id)},className:(0,o.cn)("cursor-pointer hover:bg-blue-50",_?.id===e.id&&"bg-blue-100 hover:bg-blue-100"),children:[t.jsx(u,{className:"font-medium",children:e.username}),t.jsx(u,{children:e.email}),t.jsx(u,{children:e.role})]},e.id))})]})})]}),(0,t.jsxs)(p.Zb,{className:"md:col-span-2",children:[t.jsx(p.Ol,{children:(0,t.jsxs)(p.ll,{className:"flex items-center gap-2 text-lg",children:[t.jsx(y.Z,{className:"h-5 w-5 text-green-600"})," Chat History for ",_?.username||"Select a User"]})}),t.jsx(p.aY,{className:"max-h-[70vh] overflow-y-auto p-4 bg-gray-50 rounded-lg",children:S?(0,t.jsxs)("div",{className:"flex items-center justify-center h-full",children:[t.jsx(g,{className:"h-6 w-6 animate-spin text-green-500"}),t.jsx("p",{className:"ml-2 text-gray-600",children:"Loading chat history..."})]}):_&&0===Object.keys(A).length?t.jsx("p",{className:"text-center text-gray-500",children:"No chat sessions found for this user."}):_?Object.keys(A).map(e=>{let s=A[e];return(0,t.jsxs)("div",{className:"mb-6 p-3 bg-white rounded-lg shadow-sm border-gray-200",children:[(0,t.jsxs)("div",{className:"text-sm font-semibold text-gray-700 mb-2 border-b pb-1",children:["Session (",s.assessment_type,") - ",new Date(s.created_at).toLocaleString()]}),t.jsx("div",{className:"space-y-3",children:s.messages.map((e,s)=>t.jsx("div",{className:(0,o.cn)("flex","user"===e.sender_type?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:(0,o.cn)("max-w-[80%] p-2 rounded-lg","user"===e.sender_type?"bg-blue-500 text-white":"bg-gray-200 text-gray-800"),children:[t.jsx("p",{className:"text-xs font-semibold mb-1",children:e.sender_name||e.sender_type}),t.jsx("p",{className:"text-sm",children:e.message}),t.jsx("p",{className:"text-xs text-right opacity-70 mt-1",children:new Date(e.created_at).toLocaleTimeString()})]})},s))})]},e)}):t.jsx("p",{className:"text-center text-gray-500",children:"Select a user from the list to view their chat history."})})]})]})]})}},44753:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(68570).createProxy)(String.raw`/root/hrbooteh/src/app/admin/page.tsx#default`)}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[9276,9917,5999,1322],()=>r(44958));module.exports=t})();