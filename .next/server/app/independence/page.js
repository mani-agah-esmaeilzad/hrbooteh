(()=>{var e={};e.id=214,e.ids=[214],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19596:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>c,pages:()=>m,routeModule:()=>h,tree:()=>o}),s(83932),s(98158),s(68666);var a=s(23191),r=s(88716),l=s(37922),n=s.n(l),i=s(95231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let o=["",{children:["independence",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,83932)),"/root/hrbooteh/src/app/independence/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,98158)),"/root/hrbooteh/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,68666)),"/root/hrbooteh/src/app/not-found.tsx"]}],m=["/root/hrbooteh/src/app/independence/page.tsx"],c="/independence/page",x={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/independence/page",pathname:"/independence",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},31813:(e,t,s)=>{Promise.resolve().then(s.bind(s,37858))},37858:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var a=s(10326),r=s(17577),l=s(91664),n=s(82015),i=s(62881);let d=(0,i.Z)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var o=s(86333);let m=(0,i.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var c=s(39730),x=s(71992),h=s(35047),u=s(94001),p=s(85999);let g=()=>{let e=(0,h.useRouter)(),{user:t}=(0,u.a)(),{isMobile:s}=function(){let[e,t]=(0,r.useState)(!1),[s,a]=(0,r.useState)(!1),[l,n]=(0,r.useState)(!0);return{isMobile:e,isTablet:s,isDesktop:l}}(),[i,g]=(0,r.useState)([]),[b,f]=(0,r.useState)(""),[j,w]=(0,r.useState)(!1),[y,v]=(0,r.useState)(!0),[N,D]=(0,r.useState)(!1),[k,S]=(0,r.useState)(null),[_,P]=(0,r.useState)(!1),[A,C]=(0,r.useState)(null),[I,$]=(0,r.useState)(!1),[E,T]=(0,r.useState)({}),[z,q]=(0,r.useState)({}),B=[{name:"آقای توحیدی",role:"مدیر بخش",avatar:"\uD83D\uDC68‍\uD83D\uDCBC",position:{x:50,y:15},mobilePosition:{x:50,y:10},color:"from-blue-500 to-blue-600"},{name:"سارا",role:"طراح تیم",avatar:"\uD83D\uDC69‍\uD83D\uDCBB",position:{x:15,y:45},mobilePosition:{x:20,y:35},color:"from-pink-500 to-pink-600"},{name:"احمد",role:"مسئول کیفیت",avatar:"\uD83D\uDC68‍\uD83D\uDD27",position:{x:85,y:45},mobilePosition:{x:80,y:35},color:"from-green-500 to-green-600"},{name:"خانم نوروزی",role:"بخش مالی",avatar:"\uD83D\uDC69‍\uD83D\uDCBC",position:{x:50,y:85},mobilePosition:{x:50,y:90},color:"from-purple-500 to-purple-600"},{name:t?.first_name||"شما",role:"سرپرست جدید",avatar:"\uD83C\uDFAF",position:{x:50,y:50},mobilePosition:{x:50,y:62},color:"from-orange-500 to-orange-600"}],O=async()=>{try{let t=localStorage.getItem("token");if(!t){p.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=await fetch("/api/assessment/start-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),a=await s.json();if(a.success&&a.data){if(S(a.data.session_id),P(!0),D(!0),a.data.messages&&Array.isArray(a.data.messages)){let e=a.data.messages.map((e,t)=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp),id:`initial-${t}`}));g(e),await G(e)}v(!1),p.Am.success("جلسه کاری شروع شد. می‌توانید در بحث شرکت کنید.")}else throw Error(a.message||"خطا در شروع جلسه")}catch(e){console.error("Error starting chat session:",e),p.Am.error("خطا در شروع جلسه. لطفاً دوباره تلاش کنید."),v(!1)}},Z=()=>{T({}),q({}),C(null)},G=async e=>{$(!0),Z();for(let s=0;s<e.length;s++){let a=e[s],r=a.character||("user"===a.type?t?.first_name||"شما":"سیستم");T(e=>({...e,[r]:a.content})),q(e=>({...e,[r]:!0})),C(r),s<e.length-1&&await new Promise(e=>setTimeout(e,3e3))}setTimeout(()=>C(null),2e3),$(!1)},M=async t=>{try{let s=localStorage.getItem("token");if(!s){p.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}if(!k){p.Am.error("جلسه شروع نشده است");return}let a=await fetch("/api/assessment/chat-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({message:t,session_id:k})}),r=await a.json();if(r.success&&r.data){if(r.data.messages&&Array.isArray(r.data.messages)){let e=r.data.messages.map((e,t)=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp),id:`response-${Date.now()}-${t}`}));g(t=>[...t,...e]),await G(e)}if("assessment_complete"===r.data.type||"ارزیابی تکمیل شد"===r.message){p.Am.success("ارزیابی استقلال تکمیل شد!"),(r.data.analysis||r.data)&&localStorage.setItem("independence_results",JSON.stringify({assessment_id:k,final_analysis:r.data.analysis||r.data,completed_at:new Date().toISOString(),questionnaire_type:"independence"})),setTimeout(()=>{e.push("/results")},2e3);return}}else throw Error(r.message||"خطا در ارسال پیام")}catch(e){console.error("Error sending message:",e),p.Am.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید.")}finally{w(!1)}};(0,r.useEffect)(()=>{t&&!_?O():t||e.push("/login")},[t,_,e]);let F=async()=>{if(!b.trim()||j||I)return;let e=b.trim();f("");let s={type:"user",content:e,timestamp:new Date,id:`user-${Date.now()}`};g(e=>[...e,s]),Z();let a=t?.first_name||"شما";T(t=>({...t,[a]:e})),q(e=>({...e,[a]:!0})),C(a),w(!0),setTimeout(()=>C(null),2e3),await M(e)},J=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),p.Am.success("خروج موفقیت‌آمیز بود"),e.push("/")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),p.Am.success("خروج انجام شد"),e.push("/")}};return y?a.jsx("div",{className:"min-h-screen meeting-room flex items-center justify-center px-4",children:(0,a.jsxs)("div",{className:"text-center animate-slideIn max-w-md w-full loading-container",children:[a.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-pulse character-avatar",children:a.jsx(d,{className:"w-10 h-10 text-white"})}),a.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white mb-3",children:"در حال آماده‌سازی اتاق جلسه..."}),a.jsx("p",{className:"text-slate-300 text-base md:text-lg",children:"تنظیمات صفحه در حال بارگذاری"}),a.jsx("div",{className:"mt-6 flex justify-center",children:(0,a.jsxs)("div",{className:"typing-dots-enhanced",children:[a.jsx("div",{}),a.jsx("div",{}),a.jsx("div",{})]})})]})}):(0,a.jsxs)("div",{className:"min-h-screen meeting-room",children:[a.jsx("header",{className:"bg-slate-800/95 backdrop-blur-xl border-b border-slate-600/40 sticky top-0 z-50 shadow-2xl",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 md:px-6 py-3 md:py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,a.jsxs)(l.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/"),className:"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-all duration-200 p-2",children:[a.jsx(o.Z,{className:"w-4 h-4 md:w-5 md:h-5 ml-1 md:ml-2"}),a.jsx("span",{className:"hidden sm:inline",children:"بازگشت"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[a.jsx("div",{className:"w-8 h-8 md:w-12 md:h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg md:rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(d,{className:"w-4 h-4 md:w-6 md:h-6 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-sm md:text-xl font-bold text-white",children:"جلسه ارزیابی استقلال"}),(0,a.jsxs)("p",{className:"text-xs md:text-sm text-slate-300 flex items-center gap-1 md:gap-2",children:[a.jsx(m,{className:"w-3 h-3 md:w-4 md:h-4"}),N?"جلسه در حال برگزاری":"در حال اتصال..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 md:gap-4",children:[(0,a.jsxs)("div",{className:"text-right hidden sm:block",children:[(0,a.jsxs)("p",{className:"text-xs md:text-sm font-medium text-white",children:[t?.first_name," ",t?.last_name]}),a.jsx("p",{className:"text-xs text-slate-300",children:t?.email})]}),a.jsx(l.z,{variant:"outline",size:"sm",onClick:J,className:"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200 text-xs md:text-sm px-2 md:px-3",children:"خروج"})]})]})}),a.jsx("main",{className:"flex-1 p-3 md:p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-4 md:mb-8 animate-fadeIn",children:[a.jsx("h2",{className:"text-lg md:text-2xl font-bold text-white mb-2 md:mb-3",children:"\uD83C\uDFE2 اتاق کنفرانس شرکت"}),a.jsx("p",{className:"text-slate-300 text-sm md:text-lg",children:"شما در جلسه‌ای برای بررسی پروژه مهم شرکت حضور دارید"}),I&&a.jsx("div",{className:"mt-2 text-blue-400 text-sm animate-pulse",children:"\uD83D\uDDE3️ در حال نمایش صحبت‌های جلسه..."})]}),(0,a.jsxs)("div",{className:"relative meeting-room rounded-2xl md:rounded-3xl shadow-2xl border border-slate-500/30 overflow-hidden animate-slideIn",style:{height:s?"350px":"500px",minHeight:"300px"},children:[(0,a.jsxs)("div",{className:"absolute inset-3 md:inset-6 table-surface rounded-xl md:rounded-2xl border border-amber-700/50 shadow-inner",children:[a.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 md:w-16 md:h-16 bg-gradient-to-br from-amber-600/30 to-amber-800/40 rounded-full border-2 border-amber-500/50"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-radial from-amber-300/5 via-transparent to-transparent"})]}),B.map((e,r)=>{let l=e.name,n=E[l]||"",i=z[l]||!1,d=l===(t?.first_name||"شما"),o=A===l,m=s&&e.mobilePosition||e.position;return(0,a.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 animate-fadeIn",style:{left:`${m.x}%`,top:`${m.y}%`,animationDelay:`${.2*r}s`},children:[n&&i&&a.jsx("div",{className:"absolute bottom-full mb-3 md:mb-6 left-1/2 transform -translate-x-1/2 animate-messagePopIn z-10",children:(0,a.jsxs)("div",{className:"speech-bubble-enhanced",children:[a.jsx("p",{className:"text-slate-800 text-sm md:text-base leading-relaxed font-medium break-words",children:n}),a.jsx("div",{className:"absolute -top-2 left-2 md:left-3 bg-slate-700 text-white text-xs px-2 py-1 rounded-full whitespace-nowrap",children:l})]})}),(0,a.jsxs)("div",{className:`relative group character-avatar transition-enhanced ${d?"ring-2 md:ring-4 ring-orange-400/60":""} ${o?"character-speaking":""}`,children:[a.jsx("div",{className:`w-12 h-12 md:w-24 md:h-24 bg-gradient-to-br ${e.color} rounded-full shadow-2xl flex items-center justify-center text-lg md:text-3xl border-2 md:border-4 border-white/20`,children:e.avatar}),(0,a.jsxs)("div",{className:"absolute top-full mt-2 md:mt-3 left-1/2 transform -translate-x-1/2 text-center min-w-max",children:[a.jsx("p",{className:"text-white font-bold text-xs md:text-sm bg-slate-800/80 px-2 md:px-3 py-1 rounded-full border border-slate-600/50",children:l}),a.jsx("p",{className:"text-slate-300 text-xs mt-1 hidden md:block",children:e.role})]}),j&&!d&&a.jsx("div",{className:"absolute -top-2 md:-top-3 -right-2 md:-right-3 w-6 h-6 md:w-8 md:h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-bounce",children:(0,a.jsxs)("div",{className:"typing-dots-enhanced",children:[a.jsx("div",{className:"w-1 h-1"}),a.jsx("div",{className:"w-1 h-1"}),a.jsx("div",{className:"w-1 h-1"})]})}),d&&a.jsx("div",{className:"absolute -top-1 md:-top-2 -right-1 md:-right-2 w-4 h-4 md:w-6 md:h-6 bg-green-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:a.jsx("div",{className:"w-1.5 h-1.5 md:w-2 md:h-2 bg-white rounded-full"})})]})]},r)}),(0,a.jsxs)("div",{className:"absolute top-3 md:top-6 right-3 md:right-6 bg-black/40 backdrop-blur-sm rounded-lg md:rounded-xl px-3 md:px-4 py-2 md:py-3 border border-slate-600/30",children:[(0,a.jsxs)("p",{className:"text-white text-xs md:text-sm font-semibold flex items-center gap-1 md:gap-2",children:[a.jsx(c.Z,{className:"w-3 h-3 md:w-4 md:h-4"}),"پیام‌ها: ",i.length]}),(0,a.jsxs)("p",{className:"text-slate-300 text-xs mt-1 hidden md:block",children:["شرکت‌کنندگان: ",B.length]})]}),a.jsx("div",{className:"absolute top-3 md:top-6 left-3 md:left-6 w-8 h-8 md:w-12 md:h-12 bg-gradient-to-br from-yellow-400/20 to-amber-600/30 rounded-full border border-yellow-500/30 animate-pulse",title:"نور اتاق"})]}),a.jsx("div",{className:"mt-4 md:mt-8 input-area-enhanced rounded-xl md:rounded-2xl p-4 md:p-6 shadow-2xl animate-fadeIn",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3 md:gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"نظر شما در جلسه:"}),a.jsx(n.g,{value:b,onChange:e=>f(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),F())},placeholder:"نظر خود را در جلسه بیان کنید...",className:"bg-slate-700/60 border-slate-600 text-white placeholder-slate-400 focus-enhanced min-h-[80px] md:min-h-[100px] resize-none text-sm md:text-base shadow-inner",disabled:j||I}),I&&a.jsx("p",{className:"text-blue-400 text-xs mt-2",children:"⏳ لطفاً تا پایان نمایش پیام‌ها صبر کنید..."})]}),a.jsx("div",{className:"flex flex-col justify-end",children:(0,a.jsxs)(l.z,{onClick:F,disabled:!b.trim()||j||I,className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-6 md:px-8 py-3 md:py-4 rounded-xl shadow-lg h-fit transition-enhanced disabled:opacity-50 disabled:cursor-not-allowed text-sm md:text-base w-full md:w-auto",children:[a.jsx(x.Z,{className:"w-4 h-4 md:w-5 md:h-5 ml-2"}),j?"در حال ارسال...":I?"در حال نمایش...":"صحبت کنید"]})})]})}),(0,a.jsxs)("div",{className:"mt-4 md:mt-6 bg-slate-800/40 backdrop-blur-sm rounded-xl p-3 md:p-4 border border-slate-600/30 max-h-32 md:max-h-40 overflow-y-auto animate-fadeIn",children:[(0,a.jsxs)("h3",{className:"text-white font-semibold mb-2 md:mb-3 flex items-center gap-2 text-sm md:text-base",children:[a.jsx(c.Z,{className:"w-3 h-3 md:w-4 md:h-4"}),"تاریخچه کامل جلسه"]}),(0,a.jsxs)("div",{className:"space-y-1 md:space-y-2",children:[i.slice(-5).map((e,t)=>(0,a.jsxs)("div",{className:"text-slate-300 text-xs md:text-sm p-2 bg-slate-700/30 rounded-lg",children:[(0,a.jsxs)("span",{className:"font-medium text-blue-300",children:[e.character||("user"===e.type?"شما":"سیستم"),":"]}),(0,a.jsxs)("span",{className:"mr-2 break-words",children:[e.content.slice(0,100),e.content.length>100?"...":""]}),(0,a.jsxs)("span",{className:"text-xs text-slate-400 mr-2 block md:inline",children:["(",e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"}),")"]})]},e.id||t)),0===i.length&&a.jsx("p",{className:"text-slate-400 text-center py-4 text-xs md:text-sm",children:"هنوز صحبتی در جلسه نشده است..."})]})]})]})})]})}},83932:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(19510);let r=(0,s(68570).createProxy)(String.raw`/root/hrbooteh/src/pages/IndependenceAssessment.tsx#default`);function l(){return a.jsx(r,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,917,999,848],()=>s(19596));module.exports=a})();