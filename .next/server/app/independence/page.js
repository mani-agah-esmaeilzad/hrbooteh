(()=>{var e={};e.id=214,e.ids=[214],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19596:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d}),s(83932),s(98158),s(68666);var a=s(23191),r=s(88716),l=s(37922),n=s.n(l),i=s(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["independence",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,83932)),"/root/hrbooteh/src/app/independence/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,98158)),"/root/hrbooteh/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,68666)),"/root/hrbooteh/src/app/not-found.tsx"]}],c=["/root/hrbooteh/src/app/independence/page.tsx"],m="/independence/page",x={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/independence/page",pathname:"/independence",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},31813:(e,t,s)=>{Promise.resolve().then(s.bind(s,69029))},69029:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var a=s(10326),r=s(17577),l=s(91664),n=s(82015),i=s(62881);let o=(0,i.Z)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var d=s(86333);let c=(0,i.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var m=s(39730),x=s(71992),h=s(35047),u=s(94001),p=s(85999);let g=()=>{let e=(0,h.useRouter)(),{user:t}=(0,u.a)(),[s,i]=(0,r.useState)([]),[g,b]=(0,r.useState)(""),[f,j]=(0,r.useState)(!1),[v,y]=(0,r.useState)(!0),[N,w]=(0,r.useState)(!1),[D,_]=(0,r.useState)(null),[k,S]=(0,r.useState)(!1),[A,C]=(0,r.useState)(null),P=[{name:"آقای توحیدی",role:"مدیر بخش",avatar:"\uD83D\uDC68‍\uD83D\uDCBC",position:{x:50,y:15},color:"from-blue-500 to-blue-600"},{name:"سارا",role:"طراح تیم",avatar:"\uD83D\uDC69‍\uD83D\uDCBB",position:{x:20,y:50},color:"from-pink-500 to-pink-600"},{name:"احمد",role:"مسئول کیفیت",avatar:"\uD83D\uDC68‍\uD83D\uDD27",position:{x:80,y:50},color:"from-green-500 to-green-600"},{name:"خانم نوروزی",role:"بخش مالی",avatar:"\uD83D\uDC69‍\uD83D\uDCBC",position:{x:50,y:85},color:"from-purple-500 to-purple-600"},{name:t?.first_name||"شما",role:"سرپرست جدید",avatar:"\uD83C\uDFAF",position:{x:50,y:50},color:"from-orange-500 to-orange-600"}],I=async()=>{try{let t=localStorage.getItem("token");if(!t){p.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=await fetch("/api/assessment/start-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),a=await s.json();if(a.success&&a.data){if(_(a.data.session_id),S(!0),w(!0),a.data.messages&&Array.isArray(a.data.messages)){let e=a.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));i(e)}y(!1),p.Am.success("جلسه کاری شروع شد. می‌توانید در بحث شرکت کنید.")}else throw Error(a.message||"خطا در شروع جلسه")}catch(e){console.error("Error starting chat session:",e),p.Am.error("خطا در شروع جلسه. لطفاً دوباره تلاش کنید."),y(!1)}},E=async t=>{try{let s=localStorage.getItem("token");if(!s){p.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}if(!D){p.Am.error("جلسه شروع نشده است");return}let a=await fetch("/api/assessment/chat-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({message:t,session_id:D})}),r=await a.json();if(r.success&&r.data){if(r.data.messages&&Array.isArray(r.data.messages)&&r.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)})).forEach((e,t)=>{setTimeout(()=>{i(t=>[...t,e]),C(e.character||null),setTimeout(()=>C(null),3e3)},1e3*t)}),"assessment_complete"===r.data.type||"ارزیابی تکمیل شد"===r.message){p.Am.success("ارزیابی استقلال تکمیل شد!"),(r.data.analysis||r.data)&&localStorage.setItem("independence_results",JSON.stringify({assessment_id:D,final_analysis:r.data.analysis||r.data,completed_at:new Date().toISOString(),questionnaire_type:"independence"})),setTimeout(()=>{e.push("/results")},2e3);return}}else throw Error(r.message||"خطا در ارسال پیام")}catch(e){console.error("Error sending message:",e),p.Am.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید.")}finally{j(!1)}};(0,r.useEffect)(()=>{t&&!k?I():t||e.push("/login")},[t,k,e]);let T=async()=>{if(!g.trim()||f)return;let e=g.trim();b("");let s={type:"user",content:e,timestamp:new Date};i(e=>[...e,s]),C(t?.first_name||"شما"),j(!0),setTimeout(()=>C(null),3e3),await E(e)},z=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),p.Am.success("خروج موفقیت‌آمیز بود"),e.push("/")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),p.Am.success("خروج انجام شد"),e.push("/")}},$=e=>{let a=s.filter(s=>s.character===e||"user"===s.type&&e===(t?.first_name||"شما"));return a[a.length-1]?.content||""};return v?a.jsx("div",{className:"min-h-screen meeting-room flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center animate-slideIn",children:[a.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-pulse character-avatar",children:a.jsx(o,{className:"w-10 h-10 text-white"})}),a.jsx("h2",{className:"text-3xl font-bold text-white mb-3",children:"در حال آماده‌سازی اتاق جلسه..."}),a.jsx("p",{className:"text-slate-300 text-lg",children:"تنظیمات صفحه در حال بارگذاری"}),a.jsx("div",{className:"mt-4 flex justify-center",children:(0,a.jsxs)("div",{className:"typing-dots",children:[a.jsx("div",{}),a.jsx("div",{}),a.jsx("div",{})]})})]})}):(0,a.jsxs)("div",{className:"min-h-screen meeting-room",children:[a.jsx("header",{className:"bg-slate-800/95 backdrop-blur-xl border-b border-slate-600/40 sticky top-0 z-50 shadow-2xl",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(l.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/"),className:"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-all duration-200",children:[a.jsx(d.Z,{className:"w-5 h-5 ml-2"}),"بازگشت"]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:a.jsx(o,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-xl font-bold text-white",children:"جلسه ارزیابی استقلال"}),(0,a.jsxs)("p",{className:"text-sm text-slate-300 flex items-center gap-2",children:[a.jsx(c,{className:"w-4 h-4"}),N?"جلسه در حال برگزاری":"در حال اتصال..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-white",children:[t?.first_name," ",t?.last_name]}),a.jsx("p",{className:"text-xs text-slate-300",children:t?.email})]}),a.jsx(l.z,{variant:"outline",size:"sm",onClick:z,className:"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200",children:"خروج"})]})]})}),a.jsx("main",{className:"flex-1 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8 animate-fadeIn",children:[a.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"\uD83C\uDFE2 اتاق کنفرانس شرکت"}),a.jsx("p",{className:"text-slate-300 text-lg",children:"شما در جلسه‌ای برای بررسی پروژه مهم شرکت حضور دارید"})]}),(0,a.jsxs)("div",{className:"relative meeting-room rounded-3xl shadow-2xl border border-slate-500/30 overflow-hidden animate-slideIn",style:{height:"650px"},children:[(0,a.jsxs)("div",{className:"absolute inset-6 table-surface rounded-2xl border border-amber-700/50 shadow-inner",children:[a.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-gradient-to-br from-amber-600/30 to-amber-800/40 rounded-full border-2 border-amber-500/50"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-radial from-amber-300/5 via-transparent to-transparent"})]}),P.map((e,s)=>{let r=$(e.name),l=e.name===(t?.first_name||"شما"),n=A===e.name;return(0,a.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 animate-fadeIn",style:{left:`${e.position.x}%`,top:`${e.position.y}%`,animationDelay:`${.2*s}s`},children:[r&&a.jsx("div",{className:"absolute bottom-full mb-6 left-1/2 transform -translate-x-1/2 animate-slideIn z-10",children:(0,a.jsxs)("div",{className:"speech-bubble",children:[a.jsx("p",{className:"text-slate-800 text-sm leading-relaxed font-medium",children:r}),a.jsx("div",{className:"absolute -top-2 left-3 bg-slate-700 text-white text-xs px-2 py-1 rounded-full",children:e.name})]})}),(0,a.jsxs)("div",{className:`relative group character-avatar ${l?"ring-4 ring-orange-400/60":""} ${n?"animate-pulse":""}`,children:[a.jsx("div",{className:`w-24 h-24 bg-gradient-to-br ${e.color} rounded-full shadow-2xl flex items-center justify-center text-3xl border-4 border-white/20 ${n?"ring-4 ring-blue-400 ring-opacity-75":""}`,children:e.avatar}),(0,a.jsxs)("div",{className:"absolute top-full mt-3 left-1/2 transform -translate-x-1/2 text-center min-w-max",children:[a.jsx("p",{className:"text-white font-bold text-sm bg-slate-800/80 px-3 py-1 rounded-full border border-slate-600/50",children:e.name}),a.jsx("p",{className:"text-slate-300 text-xs mt-1",children:e.role})]}),f&&!l&&a.jsx("div",{className:"absolute -top-3 -right-3 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-bounce",children:(0,a.jsxs)("div",{className:"typing-dots",children:[a.jsx("div",{className:"w-1 h-1"}),a.jsx("div",{className:"w-1 h-1"}),a.jsx("div",{className:"w-1 h-1"})]})}),l&&a.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:a.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})]},s)}),(0,a.jsxs)("div",{className:"absolute top-6 right-6 bg-black/40 backdrop-blur-sm rounded-xl px-4 py-3 border border-slate-600/30",children:[(0,a.jsxs)("p",{className:"text-white text-sm font-semibold flex items-center gap-2",children:[a.jsx(m.Z,{className:"w-4 h-4"}),"پیام‌ها: ",s.length]}),(0,a.jsxs)("p",{className:"text-slate-300 text-xs mt-1",children:["شرکت‌کنندگان: ",P.length]})]}),a.jsx("div",{className:"absolute top-6 left-6 w-12 h-12 bg-gradient-to-br from-yellow-400/20 to-amber-600/30 rounded-full border border-yellow-500/30 animate-pulse",title:"نور اتاق"})]}),a.jsx("div",{className:"mt-8 bg-slate-800/60 backdrop-blur-xl rounded-2xl p-6 border border-slate-600/40 shadow-2xl animate-fadeIn",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"نظر شما در جلسه:"}),a.jsx(n.g,{value:g,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),T())},placeholder:"نظر خود را در جلسه بیان کنید...",className:"bg-slate-700/60 border-slate-600 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-blue-500/30 min-h-[100px] resize-none text-base shadow-inner",disabled:f})]}),a.jsx("div",{className:"flex flex-col justify-end",children:(0,a.jsxs)(l.z,{onClick:T,disabled:!g.trim()||f,className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-8 py-4 rounded-xl shadow-lg h-fit transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[a.jsx(x.Z,{className:"w-5 h-5 ml-2"}),f?"در حال ارسال...":"صحبت کنید"]})})]})}),(0,a.jsxs)("div",{className:"mt-6 bg-slate-800/40 backdrop-blur-sm rounded-xl p-4 border border-slate-600/30 max-h-40 overflow-y-auto animate-fadeIn",children:[(0,a.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[a.jsx(m.Z,{className:"w-4 h-4"}),"تاریخچه صحبت‌های جلسه"]}),(0,a.jsxs)("div",{className:"space-y-2",children:[s.slice(-5).map((e,t)=>(0,a.jsxs)("div",{className:"text-slate-300 text-sm p-2 bg-slate-700/30 rounded-lg",children:[(0,a.jsxs)("span",{className:"font-medium text-blue-300",children:[e.character||("user"===e.type?"شما":"سیستم"),":"]}),a.jsx("span",{className:"mr-2",children:e.content}),(0,a.jsxs)("span",{className:"text-xs text-slate-400 mr-2",children:["(",e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"}),")"]})]},t)),0===s.length&&a.jsx("p",{className:"text-slate-400 text-center py-4",children:"هنوز صحبتی در جلسه نشده است..."})]})]})]})})]})}},83932:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(19510);let r=(0,s(68570).createProxy)(String.raw`/root/hrbooteh/src/pages/IndependenceAssessment.tsx#default`);function l(){return a.jsx(r,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,917,999,848],()=>s(19596));module.exports=a})();