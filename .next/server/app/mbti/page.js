(()=>{var e={};e.id=828,e.ids=[828],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},35667:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>d,pages:()=>m,routeModule:()=>h,tree:()=>c}),s(23380),s(98158),s(68666);var a=s(23191),r=s(88716),i=s(37922),l=s.n(i),o=s(95231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(t,n);let c=["",{children:["mbti",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,23380)),"/root/hrbooteh/src/app/mbti/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,98158)),"/root/hrbooteh/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.bind(s,68666)),"/root/hrbooteh/src/app/not-found.tsx"]}],m=["/root/hrbooteh/src/app/mbti/page.tsx"],d="/mbti/page",u={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/mbti/page",pathname:"/mbti",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},13055:(e,t,s)=>{Promise.resolve().then(s.bind(s,75217))},75217:(e,t,s)=>{"use strict";s.d(t,{default:()=>h});var a=s(10326),r=s(17577),i=s(91664),l=s(82015),o=s(39730),n=s(86333),c=s(71992),m=s(35047),d=s(94001),u=s(85999);let h=()=>{let e=(0,m.useRouter)(),{user:t}=(0,d.a)(),[s,h]=(0,r.useState)([]),[x,p]=(0,r.useState)(""),[g,v]=(0,r.useState)(!1),[b,f]=(0,r.useState)(!0),[y,j]=(0,r.useState)(!1),[w,N]=(0,r.useState)([]),[S,_]=(0,r.useState)(null),[A,P]=(0,r.useState)(!1),I=(0,r.useRef)(null),T=()=>{I.current?.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{T()},[s]);let k=async()=>{try{let t=localStorage.getItem("token");if(!t){u.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=await fetch("/api/assessment/start-mbti",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),a=await s.json();if(a.success&&a.data){if(_(a.data.session_id),P(!0),j(!0),a.data.messages&&Array.isArray(a.data.messages)){let e=a.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));h(e)}f(!1),u.Am.success("آزمون MBTI شروع شد. می‌توانید پیام خود را ارسال کنید.")}else throw Error(a.message||"خطا در شروع جلسه چت")}catch(e){console.error("Error starting chat session:",e),u.Am.error("خطا در شروع آزمون MBTI. لطفاً دوباره تلاش کنید."),f(!1)}},E=()=>({start:"/api/assessment/start-mbti",chat:"/api/assessment/chat-mbti"}),z=async t=>{try{let s=localStorage.getItem("token");if(!s){u.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}if(!S){u.Am.error("جلسه چت شروع نشده است");return}let a=E(),r=await fetch(a.chat,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({message:t,session_id:S})}),i=await r.json();if(i.success&&i.data){if(i.data.messages&&Array.isArray(i.data.messages)){let e=i.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));h(t=>[...t,...e])}"assessment_complete"===i.data.type&&(i.data.final_analysis?(localStorage.setItem("mbti_analysis",JSON.stringify(i.data.final_analysis)),e.push("/mbti-results")):(u.Am.success("آزمون MBTI تکمیل شد!"),setTimeout(()=>{e.push("/mbti-results")},3e3)))}else throw Error(i.message||"خطا در ارسال پیام")}catch(e){console.error("Error sending message:",e),u.Am.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید.")}finally{v(!1)}};(0,r.useEffect)(()=>{console.log("MBTI Assessment useEffect triggered:",{user:!!t,assessmentStarted:A}),t&&!A?k():t||e.push("/login")},[t,A,e]);let B=async()=>{if(!x.trim()||g)return;let e=x.trim();p("");let t={type:"user",content:e,timestamp:new Date};h(e=>[...e,t]),v(!0),await z(e)},M=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),u.Am.success("خروج موفقیت‌آمیز بود"),e.push("/mbti-results")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),u.Am.success("خروج انجام شد"),e.push("/mbti-results")}};return b?a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/20 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-pulse",children:a.jsx(o.Z,{className:"w-8 h-8 text-white"})}),a.jsx("h2",{className:"text-2xl font-bold text-executive-charcoal mb-2",children:"در حال بارگذاری آزمون MBTI..."}),a.jsx("p",{className:"text-executive-ash",children:"لطفاً صبر کنید"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/20",children:[a.jsx("header",{className:"bg-white/90 backdrop-blur-xl border-b border-executive-ash-light/30 sticky top-0 z-50",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(i.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/"),className:"text-executive-ash hover:text-executive-charcoal",children:[a.jsx(n.Z,{className:"w-5 h-5 ml-2"}),"بازگشت"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl flex items-center justify-center",children:a.jsx(o.Z,{className:"w-5 h-5 text-white"})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-lg font-bold text-executive-charcoal",children:"آزمون شخصیت MBTI"}),a.jsx("p",{className:"text-sm text-executive-ash",children:y?"متصل":"در حال اتصال..."})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-executive-charcoal",children:[t?.first_name," ",t?.last_name]}),a.jsx("p",{className:"text-xs text-executive-ash",children:t?.email})]}),a.jsx(i.z,{variant:"outline",size:"sm",onClick:M,className:"border-executive-ash-light text-executive-ash hover:bg-executive-ash-light/10",children:"خروج"})]})]})}),a.jsx("main",{className:"max-w-4xl mx-auto px-4 py-6",children:(0,a.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-luxury border border-executive-ash-light/30 overflow-hidden",children:[(0,a.jsxs)("div",{className:"h-96 overflow-y-auto p-6 space-y-4",children:[s.map((e,t)=>a.jsx("div",{className:`flex ${"user"===e.type?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${"user"===e.type?"bg-gradient-to-r from-purple-500 to-purple-700 text-white":"bg-executive-ash-light/20 text-executive-charcoal border border-executive-ash-light/50"}`,children:[e.character&&"user"!==e.type&&a.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:e.character}),a.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),a.jsx("p",{className:"text-xs mt-2 opacity-60",children:e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})},t)),g&&a.jsx("div",{className:"flex justify-start",children:a.jsx("div",{className:"bg-executive-ash-light/20 border border-executive-ash-light/50 px-4 py-3 rounded-2xl",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[a.jsx("div",{className:"w-2 h-2 bg-executive-ash rounded-full animate-bounce"}),a.jsx("div",{className:"w-2 h-2 bg-executive-ash rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),a.jsx("div",{className:"w-2 h-2 bg-executive-ash rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),a.jsx("div",{ref:I})]}),a.jsx("div",{className:"border-t border-executive-ash-light/30 p-6",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[a.jsx(l.g,{value:x,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),B())},placeholder:"پیام خود را بنویسید...",className:"flex-1 min-h-[60px] resize-none border-executive-ash-light/50 focus:border-purple-500/50 focus:ring-purple-500/20",disabled:g}),a.jsx(i.z,{onClick:B,disabled:!x.trim()||g,className:"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300",children:a.jsx(c.Z,{className:"w-5 h-5"})})]})})]})})]})}},23380:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(19510);let r=(0,s(68570).createProxy)(String.raw`/root/hrbooteh/src/pages/MBTIAssessment.tsx#default`);function i(){return a.jsx(r,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,917,999,848],()=>s(35667));module.exports=a})();