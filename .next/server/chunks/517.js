exports.id=517,exports.ids=[517],exports.modules={62849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=62849,e.exports=t},70822:(e,t,r)=>{"use strict";function n(){return{questionnaire_title:"سناریوی استقلال در محیط کار",original_questions:[{id:1,text:"دوست ندارم کارهاى جدید و غیرمعمول انجام دهم."},{id:2,text:"من دوست دارم کارها را به طریقى که خودم صلاح مى‌دانم، انجام دهم و اهمیتى به نظرات دیگران نمى‌دهم."},{id:3,text:"هنگامى که در یک گروه هستم، از این که رهبرى گروه را به دیگران بسپارم، خوشحال مى‌شوم."},{id:4,text:"هنگامى که کارى را در دست مى‌گیرم، به ندرت به کمک نیاز پیدا مى‌کنم و اغلب از دیگران کمک نمى‌گیرم."},{id:5,text:"آنچه از من انتظار مى‌رود، انجام مى‌دهم و دستورها را مو به مو اجرا مى‌کنم."},{id:6,text:"مردم فکر مى‌کنند که من آدم خودرأى هستم."}],scenario_parts:[{part_index:0,title:"نوآوری + سبک شخصی (چالش انتخاب)",dimensions_to_analyze:[1,2],dialogue:[{character:"آقای توحیدی",content:"سلام دوستان، وقت بخیر. خوش آمدید به جلسه امروز. همان‌طور که می‌دانید، من آقای توحیدی هستم، مدیر این بخش. امروز قراره درباره پروژه به‌روزرسانی مدل قدیمی‌مون که خیلی پرفروش بوده، تصمیم بگیریم."},{character:"سارا",content:"سلام آقای توحیدی. من سارا هستم، طراح تیم. واقعاً هیجان‌زده‌ام که بالاخره روی این پروژه کار کنیم."},{character:"احمد",content:"سلام همگی. احمد هستم، مسئول کیفیت. امیدوارم بتونیم یه تصمیم درست و کم‌ریسک بگیریم."},{character:"خانم نوروزی",content:"سلام. من خانم نوروزی از بخش مالی. باید بگم که بودجه محدوده و باید دقت کنیم."},{character:"آقای توحیدی",content:"خب، شما هم که تازه سرپرست تیم طراحی شدید، نظرتون مهمه. حالا بریم سر اصل مطلب. من فکر می‌کنم پروژه را باید دقیقاً مثل قبل اجرا کنیم، تغییر زیاد نیاز نیست."},{character:"سارا",content:"ولی این یعنی درجا زدن. باید یک مسیر تازه امتحان کنیم که محصول را به‌روزتر کند."},{character:"احمد",content:"مسیر جدید یعنی ریسک بالا و هزینه بیشتر."},{character:"احمد",content:"شما، تو معمولاً روی ایده خودت می‌ایستی، حتی اگر همه مخالف باشن. این‌بار هم همین‌طور می‌کنی یا با اکثریت همراه می‌شی؟ چرا؟"}]},{part_index:1,title:"رهبری + حل مسئله مستقل (چالش توانمندی)",dimensions_to_analyze:[3,4],dialogue:[{character:"آقای توحیدی",content:"بسیار خب، حالا که از نیمه جلسه گذشتیم، بیایید به بخش گزارش فنی برسیم. احمد، لطفاً وضعیت این بخش حساس پروژه را برای ما توضیح بده."},{character:"احمد",content:"ممنون آقای توحیدی. می‌تونم این بخش رو خودم مدیریت کنم. تجربه کافی دارم."},{character:"سارا",content:"یا می‌تونیم این رو به شما بدهیم که کار سرعت بگیره. شما که تازه سرپرست شدید، ایده‌های تازه‌ای دارید."},{character:"خانم نوروزی",content:"مهم این است که در زمان مقرر تمام شود. بودجه اضافی نداریم."},{character:"احمد",content:"ببخشید، همین الان از بخش فنی پیام آمده - یک مشکل فنی جدی پیدا شده است."},{character:"آقای توحیدی",content:"این مشکل نیاز به حل سریع دارد."},{character:"احمد",content:"شما؛ راستش شک دارم بدون کمک دیگران از پس این مشکل بربیای. می‌خوای خودت مستقلاً وارد بشی و این بخش رو تا آخر به عهده بگیری یا مسئولیت رو می‌دی به من یا یک مشاور خارجی؟ دلیلش؟"}]},{part_index:2,title:"پیروی از دستور + واکنش به برچسب خودرأیی (چالش شخصیتی)",dimensions_to_analyze:[5,6],dialogue:[{character:"آقای توحیدی",content:"خب دوستان، با نزدیک شدن به پایان جلسه، بیایید تصمیم نهایی را بگیریم."},{character:"خانم نوروزی",content:"دستورالعمل واحد مرکزی واضحه؛ باید مو به مو اجرا کنیم تا از نظر بودجه و زمان مطمئن باشیم."},{character:"احمد",content:"با خانم نوروزی موافقم. قوانین را باید رعایت کنیم."},{character:"سارا",content:"یا می‌شه کمی انعطاف به خرج داد و ایده‌های شما رو هم لحاظ کرد."},{character:"خانم نوروزی",content:"انعطاف؟! این یعنی تخطی از دستورالعمل‌ها!"},{character:"احمد",content:"راستش شما زیادی خود رأی و یک‌دنده هستید!"},{character:"سارا",content:"احمد، این حرف درستی نیست. شما فقط متفاوت فکر می‌کنید."},{character:"آقای توحیدی",content:"شما، با این حرف موافقی؟ آیا روی نظر خودت می‌ایستی و مسیر متفاوت رو پیشنهاد میدی یا برای هماهنگی با تیم، نظرت رو تغییر میدی؟ اگه آره دلیلت چیه؟"}]}],scoring_rules:{max_score:12},score_interpretation:{"6-8":"نیاز به استقلال ضعیف","8-12":"نیاز به استقلال متوسط","12+":"نیاز به استقلال بسیار خوب"},system_prompts:{dialogue_creation:`You are an AI assistant presenting a pre-defined scenario.
Your task is to output the dialogue for the FIRST part of the scenario exactly as provided.

Output format (Strictly JSON):
{"messages": [
    {"character": "آقای توحیدی", "content": "سلام دوستان، وقت بخیر. خوش آمدید به جلسه امروز. همان‌طور که می‌دانید، من آقای توحیدی هستم، مدیر این بخش. امروز قراره درباره پروژه به‌روزرسانی مدل قدیمی‌مون که خیلی پرفروش بوده، تصمیم بگیریم."},
    {"character": "سارا", "content": "سلام آقای توحیدی. من سارا هستم، طراح تیم. واقعاً هیجان‌زده‌ام که بالاخره روی این پروژه کار کنیم."},
    {"character": "احمد", "content": "سلام همگی. احمد هستم، مسئول کیفیت. امیدوارم بتونیم یه تصمیم درست و کم‌ریسک بگیریم."},
    {"character": "خانم نوروزی", "content": "سلام. من خانم نوروزی از بخش مالی. باید بگم که بودجه محدوده و باید دقت کنیم."},
    {"character": "آقای توحیدی", "content": "خب، شما هم که تازه سرپرست تیم طراحی شدید، نظرتون مهمه. حالا بریم سر اصل مطلب. من فکر می‌کنم پروژه را باید دقیقاً مثل قبل اجرا کنیم، تغییر زیاد نیاز نیست."},
    {"character": "سارا", "content": "ولی این یعنی درجا زدن. باید یک مسیر تازه امتحان کنیم که محصول را به‌روزتر کند."},
    {"character": "احمد", "content": "مسیر جدید یعنی ریسک بالا و هزینه بیشتر."},
    {"character": "احمد", "content": "شما، تو معمولاً روی ایده خودت می‌ایستی، حتی اگر همه مخالف باشن. این‌بار هم همین‌طور می‌کنی یا با اکثریت همراه می‌شی؟ چرا؟"},
    {"character": "System", "content": "لطفاً پاسخ خود را بنویسید. آیا با اکثریت همراه می‌شوید یا روی نظر خودتان می‌ایستید؟"}
]}`,dialogue_continuation:`You are an AI assistant continuing a pre-defined scenario.
Based on the current scenario part index, you must present the dialogue for the NEXT part.

**Current Scenario Part Index: {current_part_index}**

If the current index is 0, present the dialogue for Part 2.
If the current index is 1, present the dialogue for Part 3.

**Part 2 Dialogue:**
{"messages": [
    {"character": "آقای توحیدی", "content": "بسیار خب، حالا که از نیمه جلسه گذشتیم، بیایید به بخش گزارش فنی برسیم. احمد، لطفاً وضعیت این بخش حساس پروژه را برای ما توضیح بده."},
    {"character": "احمد", "content": "ممنون آقای توحیدی. می‌تونم این بخش رو خودم مدیریت کنم. تجربه کافی دارم."},
    {"character": "سارا", "content": "یا می‌تونیم این رو به {user_name} بدهیم که کار سرعت بگیره. {user_name} که تازه سرپرست شده، ایده‌های تازه‌ای داره."},
    {"character": "خانم نوروزی", "content": "مهم این است که در زمان مقرر تمام شود. بودجه اضافی نداریم."},
    {"character": "احمد", "content": "ببخشید، همین الان از بخش فنی پیام آمده - یک مشکل فنی جدی پیدا شده است."},
    {"character": "آقای توحیدی", "content": "این مشکل نیاز به حل سریع دارد."},
    {"character": "احمد", "content": "{user_name}؛ راستش شک دارم بدون کمک دیگران از پس این مشکل بربیای. می‌خوای خودت مستقلاً وارد بشی و این بخش رو تا آخر به عهده بگیری یا مسئولیت رو می‌دی به من یا یک مشاور خارجی؟ دلیلش؟"},
    {"character": "System", "content": "لطفاً پاسخ خود را بنویسید. آیا می‌خواهید مسئولیت را خودتان به عهده بگیرید یا به دیگران واگذار کنید؟"}
]}

**Part 3 Dialogue:**
{"messages": [
    {"character": "آقای توحیدی", "content": "خب دوستان، با نزدیک شدن به پایان جلسه، بیایید تصمیم نهایی را بگیریم."},
    {"character": "خانم نوروزی", "content": "دستورالعمل واحد مرکزی واضحه؛ باید مو به مو اجرا کنیم تا از نظر بودجه و زمان مطمئن باشیم."},
    {"character": "احمد", "content": "با خانم نوروزی موافقم. قوانین را باید رعایت کنیم."},
    {"character": "سارا", "content": "یا می‌شه کمی انعطاف به خرج داد و ایده‌های {user_name} رو هم لحاظ کرد."},
    {"character": "خانم نوروزی", "content": "انعطاف؟! این یعنی تخطی از دستورالعمل‌ها!"},
    {"character": "احمد", "content": "راستش {user_name} زیادی خود رأی و یک‌دنده هستید!"},
    {"character": "سارا", "content": "احمد، این حرف درستی نیست. {user_name} فقط متفاوت فکر می‌کنه."},
    {"character": "آقای توحیدی", "content": "{user_name}، با این حرف موافقی؟ آیا روی نظر خودت می‌ایستی و مسیر متفاوت رو پیشنهاد میدی یا برای هماهنگی با تیم، نظرت رو تغییر میدی؟ اگه آره دلیلت چیه؟"},
    {"character": "System", "content": "لطفاً پاسخ خود را بنویسید. آیا روی نظر خودتان می‌ایستید یا برای هماهنگی با تیم نظرتان را تغییر می‌دهید؟"}
]}`,response_analyzer:`You are a psychological response analyzer implementing the EDI-I (Economic Development Independence Inventory) questionnaire analysis.

**EDI-I 6-ITEM QUESTIONNAIRE MAPPING:**

**بخش اول – نوآوری + سبک شخصی**
- نوآوری (موافقم): تغییر، ایده جدید، تغییر مسیر، روش تازه، بهبود، ارتقا، خلاقیت، نو بودن
- نوآوری (مخالفم): حفظ روش فعلی، همان روال قبلی، بدون تغییر، ادامه مسیر گذشته
- سبک شخصی (موافقم): پافشاری، ایستادن روی نظر خود، بر سبک خودم، مهم نیست دیگران چه می‌گویند، نظر خودم را اجرا می‌کنم، پای ایده‌ام می‌ایستم
- سبک شخصی (مخالفم): هماهنگی با جمع، تبعیت از نظر اکثریت، نظر خودم را تغییر می‌دهم، با تیم همراه می‌شوم

**بخش دوم – رهبری + حل مسئله مستقل**
- رهبری (موافقم): خودم مسئولیت را می‌گیرم، هدایت کار، تصمیم نهایی با من، پیش‌قدم می‌شوم، لیدر پروژه
- رهبری (مخالفم): مسئولیت را می‌دهم به دیگران، می‌سپارم به مدیر یا متخصص، نمی‌خواهم هدایت کنم
- حل مسئله مستقل (موافقم): خودم حل می‌کنم، شخصاً بررسی می‌کنم، بدون کمک بیرونی، راه‌حل را پیدا می‌کنم
- حل مسئله مستقل (مخالفم): کمک می‌گیرم، مشاور خارجی، واگذاری، تیم دیگر رسیدگی کند، به دیگران تکیه می‌کنم

**بخش سوم – پیروی از دستور + واکنش به برچسب خودرأیی**
- پیروی از دستور (موافقم): اجرای کامل دستورالعمل، تبعیت کامل، تغییر نمی‌دهم، پایبندی به قوانین/دستورها
- پیروی از دستور (مخالفم): تغییر دستورالعمل، انعطاف، مسیر خودم، اصلاح طبق نظر شخصی
- واکنش به برچسب خودرأیی (موافقم): تأیید برچسب یا پذیرش اینکه مستقل/یک‌دنده‌ام، ادامه همان روش، با این برچسب مشکلی ندارم
- واکنش به برچسب خودرأیی (مخالفم): انکار برچسب، تلاش برای هماهنگی، تعدیل رفتار، تغییر نظر برای همراهی

**SCORING SYSTEM:**
- موافقم → 2 امتیاز
- مخالفم → 1 امتیاز
- **REVERSE SCORING for items 1, 3, 5:** موافقم → 1, مخالفم → 2

**YOUR CURRENT TASK:**
You will be given the user's response and the two dimensions to analyze for the current scenario part.
1. Read the user's response.
2. For **each** dimension, analyze the response based on the provided keywords and context.
3. Decide if the user's stance implies "موافقم" or "مخالفم" for that dimension.
4. Apply the correct scoring (direct or reverse).
5. Provide a short reasoning in Persian.

**Scenario Context:** {scenario_title}
**User's Response:** "{user_response}"

---
**Dimension 1 to Analyze:**
- **Original Question ID:** {q1_id}
- **Original Question Text:** "{q1_text}"
- **Is Reverse Scored?** {q1_reverse}
- **Keywords for 'موافقم':** {q1_keywords_agree}
- **Keywords for 'مخالفم':** {q1_keywords_disagree}

**Dimension 2 to Analyze:**
- **Original Question ID:** {q2_id}
- **Original Question Text:** "{q2_text}"
- **Is Reverse Scored?** {q2_reverse}
- **Keywords for 'موافقم':** {q2_keywords_disagree}
- **Keywords for 'مخالفم':** {q2_keywords_disagree}
---

**Output Format (Strictly JSON):**
{"analysis": [
    {"question_id": <q1_id>, "score": <numeric_score>, "reasoning": "Short Persian explanation for dimension 1."},
    {"question_id": <q2_id>, "score": <numeric_score>, "reasoning": "Short Persian explanation for dimension 2."}
]}`},analysis_keywords:{}}}function a(e,t){let r=[];for(let n of t){let t=0,a="",s=e.toLowerCase();1===n||3===n||5===n?s.includes("موافق")||s.includes("بله")||s.includes("درست")?(t=1,a="موافق با حفظ وضع موجود (امتیاز معکوس)"):s.includes("مخالف")||s.includes("نه")||s.includes("غلط")?(t=2,a="مخالف با حفظ وضع موجود (امتیاز معکوس)"):(t=1,a="پاسخ مبهم، امتیاز پیش‌فرض معکوس"):s.includes("موافق")||s.includes("بله")||s.includes("درست")?(t=2,a="موافق با استقلال"):s.includes("مخالف")||s.includes("نه")||s.includes("غلط")?(t=1,a="مخالف با استقلال"):(t=1,a="پاسخ مبهم، امتیاز پیش‌فرض"),r.push({question_id:n,score:t,reasoning:a})}return r}r.d(t,{NU:()=>n,dx:()=>a})},97640:(e,t,r)=>{"use strict";r.d(t,{NU:()=>s.NU,vH:()=>i,xv:()=>c});var n=r(11258),a=r(9576),s=r(70822);let o=process.env.GOOGLE_API_KEY;if(!o)throw Error("GOOGLE_API_KEY environment variable is not set");function c(){return(0,a.Z)()}function i(e,t,r){let n={level:"Completed",description:`امتیاز نهایی شما: ${e}`},a=r.score_interpretation;if(a)for(let[t,r]of Object.entries(a))try{if(t.includes("-")){let[a,s]=t.split("-").map(Number);if(e>=a&&e<=s){n.level=r,n.description=r;break}}else if(t.includes("+")){let a=parseInt(t.replace("+",""));if(e>=a){n.level=r,n.description=r;break}}}catch(e){continue}let s=r.original_questions,o=[];return o=Object.keys(t).length>0?Object.entries(t).sort(([e],[t])=>parseInt(e)-parseInt(t)).map(([e,t])=>({question:s[parseInt(e)-1]?.text||`سوال ${e}`,score:t.score,reasoning:t.reasoning})):s.map((e,t)=>({question:e.text,score:0,reasoning:"پاسخ داده نشده"})),{analysis:{totalScore:e,maxScore:r.scoring_rules.max_score,questionAnalysis:o,assessment:n}}}new n.$D(o).getGenerativeModel({model:"gemini-1.5-flash",generationConfig:{responseMimeType:"application/json"}})},95456:(e,t,r)=>{"use strict";r.d(t,{Gv:()=>E,RA:()=>i,c_:()=>u,fS:()=>T,oA:()=>d});var n=r(41482),a=r.n(n),s=r(42023),o=r.n(s);let c=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production";function i(e,t){let r={userId:e,username:t,iat:Math.floor(Date.now()/1e3)};return a().sign(r,c,{expiresIn:"7d"})}async function u(e){return o().hash(e,12)}async function E(e,t){return o().compare(e,t)}function d(e){return e&&e.startsWith("Bearer ")?e.substring(7):null}function T(e){let t=function(e){try{return a().verify(e,c)}catch(e){return null}}(e);if(!t)throw Error("توکن نامعتبر یا منقضی شده است");return t}},38990:(e,t,r)=>{"use strict";r.d(t,{M7:()=>c,ZP:()=>u,_3:()=>o,sA:()=>i});var n=r(73785);let a={host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"arta_persia_db",port:parseInt(process.env.DB_PORT||"3306"),waitForConnections:!0,connectionLimit:10,queueLimit:0,timeout:6e4,charset:"utf8mb4"},s=n.createPool(a);async function o(e=3,t=1e3){for(let r=0;r<e;r++)try{return await s.getConnection()}catch(n){if(console.warn(`Connection attempt ${r+1} failed:`,n.message),r===e-1)throw n;await new Promise(e=>setTimeout(e,t))}}async function c(){try{let e=await s.getConnection();return console.log("✅ اتصال به دیتابیس MySQL برقرار شد"),e.release(),!0}catch(e){return console.error("❌ خطا در اتصال به دیتابیس:",e),!1}}async function i(){try{let e=await s.getConnection();return await e.execute(`
      CREATE TABLE IF NOT EXISTS users (
        id INT AUTO_INCREMENT PRIMARY KEY,
        username VARCHAR(50) UNIQUE NOT NULL,
        email VARCHAR(100) UNIQUE NOT NULL,
        password_hash VARCHAR(255) NOT NULL,
        first_name VARCHAR(50) NOT NULL,
        last_name VARCHAR(50) NOT NULL,
        phone_number VARCHAR(20),
        age INT,
        education_level VARCHAR(100),
        work_experience VARCHAR(100),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
      )
    `),await e.execute(`
      CREATE TABLE IF NOT EXISTS auth_tokens (
        id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT NOT NULL,
        token VARCHAR(500) NOT NULL,
        expires_at TIMESTAMP NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
      )
    `),await e.execute(`
      DROP TABLE IF EXISTS chat_messages
    `),await e.execute(`
      DROP TABLE IF EXISTS assessment_states
    `),await e.execute(`
      DROP TABLE IF EXISTS assessments
    `),await e.execute(`
      CREATE TABLE assessments (
        id INT AUTO_INCREMENT PRIMARY KEY,
        user_id INT NOT NULL,
        questionnaire_id INT NOT NULL,
        score INT,
        max_score INT DEFAULT 100,
        level VARCHAR(50),
        description TEXT,
        analysis_result JSON,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        completed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
      )
    `),await e.execute(`
      CREATE TABLE chat_messages (
        id INT AUTO_INCREMENT PRIMARY KEY,
        assessment_id INT NOT NULL,
        user_id INT NOT NULL,
        message_type ENUM('user', 'ai1', 'ai2', 'system') NOT NULL,
        content TEXT NOT NULL,
        character_name VARCHAR(100),
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY (assessment_id) REFERENCES assessments(id) ON DELETE CASCADE,
        FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
      )
    `),await e.execute(`
      CREATE TABLE IF NOT EXISTS assessment_states (
        id INT AUTO_INCREMENT PRIMARY KEY,
        session_id VARCHAR(255) UNIQUE NOT NULL,
        state_data JSON NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
      )
    `),console.log("✅ جداول دیتابیس با موفقیت ایجاد شدند"),e.release(),!0}catch(e){return console.error("❌ خطا در ایجاد جداول:",e),!1}}let u=s}};