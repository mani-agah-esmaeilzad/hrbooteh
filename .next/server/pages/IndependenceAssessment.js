"use strict";(()=>{var e={};e.id=635,e.ids=[635,660],e.modules={70450:(e,t,s)=>{s.r(t),s.d(t,{config:()=>P,default:()=>k,getServerSideProps:()=>C,getStaticPaths:()=>_,getStaticProps:()=>D,reportWebVitals:()=>A,routeModule:()=>E,unstable_getServerProps:()=>Z,unstable_getServerSideProps:()=>$,unstable_getStaticParams:()=>q,unstable_getStaticPaths:()=>z,unstable_getStaticProps:()=>I});var a={};s.r(a),s.d(a,{default:()=>S});var r=s(87093),l=s(35244),n=s(1323),i=s(61682),o=s.n(i),d=s(48141),c=s.n(d),m=s(20997),u=s(16689),x=s(95189),h=s(9451),p=s(33592);let g=(0,p.Z)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var f=s(99763);let b=(0,p.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var v=s(50083),y=s(40594),j=s(39332),w=s(37568),N=s(11399);let S=()=>{let e=(0,j.useRouter)(),{user:t}=(0,w.a)(),[s,a]=(0,u.useState)([]),[r,l]=(0,u.useState)(""),[n,i]=(0,u.useState)(!1),[o,d]=(0,u.useState)(!0),[c,p]=(0,u.useState)(!1),[S,k]=(0,u.useState)(null),[D,_]=(0,u.useState)(!1),[C,P]=(0,u.useState)(null),A=[{name:"آقای توحیدی",role:"مدیر بخش",avatar:"\uD83D\uDC68‍\uD83D\uDCBC",position:{x:50,y:15},color:"from-blue-500 to-blue-600"},{name:"سارا",role:"طراح تیم",avatar:"\uD83D\uDC69‍\uD83D\uDCBB",position:{x:20,y:50},color:"from-pink-500 to-pink-600"},{name:"احمد",role:"مسئول کیفیت",avatar:"\uD83D\uDC68‍\uD83D\uDD27",position:{x:80,y:50},color:"from-green-500 to-green-600"},{name:"خانم نوروزی",role:"بخش مالی",avatar:"\uD83D\uDC69‍\uD83D\uDCBC",position:{x:50,y:85},color:"from-purple-500 to-purple-600"},{name:t?.first_name||"شما",role:"سرپرست جدید",avatar:"\uD83C\uDFAF",position:{x:50,y:50},color:"from-orange-500 to-orange-600"}],I=async()=>{try{let t=localStorage.getItem("token");if(!t){N.toast.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=await fetch("/api/assessment/start-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),r=await s.json();if(r.success&&r.data){if(k(r.data.session_id),_(!0),p(!0),r.data.messages&&Array.isArray(r.data.messages)){let e=r.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));a(e)}d(!1),N.toast.success("جلسه کاری شروع شد. می‌توانید در بحث شرکت کنید.")}else throw Error(r.message||"خطا در شروع جلسه")}catch(e){console.error("Error starting chat session:",e),N.toast.error("خطا در شروع جلسه. لطفاً دوباره تلاش کنید."),d(!1)}},z=async t=>{try{let s=localStorage.getItem("token");if(!s){N.toast.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}if(!S){N.toast.error("جلسه شروع نشده است");return}let r=await fetch("/api/assessment/chat-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({message:t,session_id:S})}),l=await r.json();if(l.success&&l.data){if(l.data.messages&&Array.isArray(l.data.messages)&&l.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)})).forEach((e,t)=>{setTimeout(()=>{a(t=>[...t,e]),P(e.character||null),setTimeout(()=>P(null),3e3)},1e3*t)}),"assessment_complete"===l.data.type||"ارزیابی تکمیل شد"===l.message){N.toast.success("ارزیابی استقلال تکمیل شد!"),(l.data.analysis||l.data)&&localStorage.setItem("independence_results",JSON.stringify({assessment_id:S,final_analysis:l.data.analysis||l.data,completed_at:new Date().toISOString(),questionnaire_type:"independence"})),setTimeout(()=>{e.push("/results")},2e3);return}}else throw Error(l.message||"خطا در ارسال پیام")}catch(e){console.error("Error sending message:",e),N.toast.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید.")}finally{i(!1)}};(0,u.useEffect)(()=>{t&&!D?I():t||e.push("/login")},[t,D,e]);let q=async()=>{if(!r.trim()||n)return;let e=r.trim();l("");let s={type:"user",content:e,timestamp:new Date};a(e=>[...e,s]),P(t?.first_name||"شما"),i(!0),setTimeout(()=>P(null),3e3),await z(e)},Z=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),N.toast.success("خروج موفقیت‌آمیز بود"),e.push("/")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),N.toast.success("خروج انجام شد"),e.push("/")}},$=e=>{let a=s.filter(s=>s.character===e||"user"===s.type&&e===(t?.first_name||"شما"));return a[a.length-1]?.content||""};return o?m.jsx("div",{className:"min-h-screen meeting-room flex items-center justify-center",children:(0,m.jsxs)("div",{className:"text-center animate-slideIn",children:[m.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-pulse character-avatar",children:m.jsx(g,{className:"w-10 h-10 text-white"})}),m.jsx("h2",{className:"text-3xl font-bold text-white mb-3",children:"در حال آماده‌سازی اتاق جلسه..."}),m.jsx("p",{className:"text-slate-300 text-lg",children:"تنظیمات صفحه در حال بارگذاری"}),m.jsx("div",{className:"mt-4 flex justify-center",children:(0,m.jsxs)("div",{className:"typing-dots",children:[m.jsx("div",{}),m.jsx("div",{}),m.jsx("div",{})]})})]})}):(0,m.jsxs)("div",{className:"min-h-screen meeting-room",children:[m.jsx("header",{className:"bg-slate-800/95 backdrop-blur-xl border-b border-slate-600/40 sticky top-0 z-50 shadow-2xl",children:(0,m.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[(0,m.jsxs)(x.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/"),className:"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-all duration-200",children:[m.jsx(f.Z,{className:"w-5 h-5 ml-2"}),"بازگشت"]}),(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[m.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:m.jsx(g,{className:"w-6 h-6 text-white"})}),(0,m.jsxs)("div",{children:[m.jsx("h1",{className:"text-xl font-bold text-white",children:"جلسه ارزیابی استقلال"}),(0,m.jsxs)("p",{className:"text-sm text-slate-300 flex items-center gap-2",children:[m.jsx(b,{className:"w-4 h-4"}),c?"جلسه در حال برگزاری":"در حال اتصال..."]})]})]})]}),(0,m.jsxs)("div",{className:"flex items-center gap-4",children:[(0,m.jsxs)("div",{className:"text-right",children:[(0,m.jsxs)("p",{className:"text-sm font-medium text-white",children:[t?.first_name," ",t?.last_name]}),m.jsx("p",{className:"text-xs text-slate-300",children:t?.email})]}),m.jsx(x.z,{variant:"outline",size:"sm",onClick:Z,className:"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200",children:"خروج"})]})]})}),m.jsx("main",{className:"flex-1 p-6",children:(0,m.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,m.jsxs)("div",{className:"text-center mb-8 animate-fadeIn",children:[m.jsx("h2",{className:"text-2xl font-bold text-white mb-3",children:"\uD83C\uDFE2 اتاق کنفرانس شرکت"}),m.jsx("p",{className:"text-slate-300 text-lg",children:"شما در جلسه‌ای برای بررسی پروژه مهم شرکت حضور دارید"})]}),(0,m.jsxs)("div",{className:"relative meeting-room rounded-3xl shadow-2xl border border-slate-500/30 overflow-hidden animate-slideIn",style:{height:"650px"},children:[(0,m.jsxs)("div",{className:"absolute inset-6 table-surface rounded-2xl border border-amber-700/50 shadow-inner",children:[m.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-gradient-to-br from-amber-600/30 to-amber-800/40 rounded-full border-2 border-amber-500/50"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-radial from-amber-300/5 via-transparent to-transparent"})]}),A.map((e,s)=>{let a=$(e.name),r=e.name===(t?.first_name||"شما"),l=C===e.name;return(0,m.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 animate-fadeIn",style:{left:`${e.position.x}%`,top:`${e.position.y}%`,animationDelay:`${.2*s}s`},children:[a&&m.jsx("div",{className:"absolute bottom-full mb-6 left-1/2 transform -translate-x-1/2 animate-slideIn z-10",children:(0,m.jsxs)("div",{className:"speech-bubble",children:[m.jsx("p",{className:"text-slate-800 text-sm leading-relaxed font-medium",children:a}),m.jsx("div",{className:"absolute -top-2 left-3 bg-slate-700 text-white text-xs px-2 py-1 rounded-full",children:e.name})]})}),(0,m.jsxs)("div",{className:`relative group character-avatar ${r?"ring-4 ring-orange-400/60":""} ${l?"animate-pulse":""}`,children:[m.jsx("div",{className:`w-24 h-24 bg-gradient-to-br ${e.color} rounded-full shadow-2xl flex items-center justify-center text-3xl border-4 border-white/20 ${l?"ring-4 ring-blue-400 ring-opacity-75":""}`,children:e.avatar}),(0,m.jsxs)("div",{className:"absolute top-full mt-3 left-1/2 transform -translate-x-1/2 text-center min-w-max",children:[m.jsx("p",{className:"text-white font-bold text-sm bg-slate-800/80 px-3 py-1 rounded-full border border-slate-600/50",children:e.name}),m.jsx("p",{className:"text-slate-300 text-xs mt-1",children:e.role})]}),n&&!r&&m.jsx("div",{className:"absolute -top-3 -right-3 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-bounce",children:(0,m.jsxs)("div",{className:"typing-dots",children:[m.jsx("div",{className:"w-1 h-1"}),m.jsx("div",{className:"w-1 h-1"}),m.jsx("div",{className:"w-1 h-1"})]})}),r&&m.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:m.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})]},s)}),(0,m.jsxs)("div",{className:"absolute top-6 right-6 bg-black/40 backdrop-blur-sm rounded-xl px-4 py-3 border border-slate-600/30",children:[(0,m.jsxs)("p",{className:"text-white text-sm font-semibold flex items-center gap-2",children:[m.jsx(v.Z,{className:"w-4 h-4"}),"پیام‌ها: ",s.length]}),(0,m.jsxs)("p",{className:"text-slate-300 text-xs mt-1",children:["شرکت‌کنندگان: ",A.length]})]}),m.jsx("div",{className:"absolute top-6 left-6 w-12 h-12 bg-gradient-to-br from-yellow-400/20 to-amber-600/30 rounded-full border border-yellow-500/30 animate-pulse",title:"نور اتاق"})]}),m.jsx("div",{className:"mt-8 bg-slate-800/60 backdrop-blur-xl rounded-2xl p-6 border border-slate-600/40 shadow-2xl animate-fadeIn",children:(0,m.jsxs)("div",{className:"flex gap-4",children:[(0,m.jsxs)("div",{className:"flex-1",children:[m.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"نظر شما در جلسه:"}),m.jsx(h.g,{value:r,onChange:e=>l(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),q())},placeholder:"نظر خود را در جلسه بیان کنید...",className:"bg-slate-700/60 border-slate-600 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-blue-500/30 min-h-[100px] resize-none text-base shadow-inner",disabled:n})]}),m.jsx("div",{className:"flex flex-col justify-end",children:(0,m.jsxs)(x.z,{onClick:q,disabled:!r.trim()||n,className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-8 py-4 rounded-xl shadow-lg h-fit transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[m.jsx(y.Z,{className:"w-5 h-5 ml-2"}),n?"در حال ارسال...":"صحبت کنید"]})})]})}),(0,m.jsxs)("div",{className:"mt-6 bg-slate-800/40 backdrop-blur-sm rounded-xl p-4 border border-slate-600/30 max-h-40 overflow-y-auto animate-fadeIn",children:[(0,m.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[m.jsx(v.Z,{className:"w-4 h-4"}),"تاریخچه صحبت‌های جلسه"]}),(0,m.jsxs)("div",{className:"space-y-2",children:[s.slice(-5).map((e,t)=>(0,m.jsxs)("div",{className:"text-slate-300 text-sm p-2 bg-slate-700/30 rounded-lg",children:[(0,m.jsxs)("span",{className:"font-medium text-blue-300",children:[e.character||("user"===e.type?"شما":"سیستم"),":"]}),m.jsx("span",{className:"mr-2",children:e.content}),(0,m.jsxs)("span",{className:"text-xs text-slate-400 mr-2",children:["(",e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"}),")"]})]},t)),0===s.length&&m.jsx("p",{className:"text-slate-400 text-center py-4",children:"هنوز صحبتی در جلسه نشده است..."})]})]})]})})]})},k=(0,n.l)(a,"default"),D=(0,n.l)(a,"getStaticProps"),_=(0,n.l)(a,"getStaticPaths"),C=(0,n.l)(a,"getServerSideProps"),P=(0,n.l)(a,"config"),A=(0,n.l)(a,"reportWebVitals"),I=(0,n.l)(a,"unstable_getStaticProps"),z=(0,n.l)(a,"unstable_getStaticPaths"),q=(0,n.l)(a,"unstable_getStaticParams"),Z=(0,n.l)(a,"unstable_getServerProps"),$=(0,n.l)(a,"unstable_getServerSideProps"),E=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/IndependenceAssessment",pathname:"/IndependenceAssessment",bundlePath:"",filename:""},components:{App:c(),Document:o()},userland:a})},33592:(e,t,s)=>{s.d(t,{Z:()=>o});var a=s(16689);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:d,...c},m)=>(0,a.createElement)("svg",{ref:m,...n,width:t,height:t,stroke:e,strokeWidth:r?24*Number(s)/Number(t):s,className:l("lucide",i),...c},[...d.map(([e,t])=>(0,a.createElement)(e,t)),...Array.isArray(o)?o:[o]])),o=(e,t)=>{let s=(0,a.forwardRef)(({className:s,...n},o)=>(0,a.createElement)(i,{ref:o,iconNode:t,className:l(`lucide-${r(e)}`,s),...n}));return s.displayName=`${e}`,s}},99763:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(33592).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},50083:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(33592).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},40594:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(33592).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},95189:(e,t,s)=>{s.d(t,{z:()=>d});var a=s(20997),r=s(16689);let l=require("@radix-ui/react-slot");var n=s(41169),i=s(51093);let o=(0,n.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef(({className:e,variant:t,size:s,asChild:r=!1,...n},d)=>{let c=r?l.Slot:"button";return a.jsx(c,{className:(0,i.cn)(o({variant:t,size:s,className:e})),ref:d,...n})});d.displayName="Button"},9451:(e,t,s)=>{s.d(t,{g:()=>n});var a=s(20997),r=s(16689),l=s(51093);let n=r.forwardRef(({className:e,...t},s)=>a.jsx("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));n.displayName="Textarea"},37568:(e,t,s)=>{s.d(t,{a:()=>l}),s(20997);var a=s(16689);let r=(0,a.createContext)(void 0),l=()=>{let e=(0,a.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},51093:(e,t,s)=>{s.d(t,{cn:()=>l});let a=require("clsx"),r=require("tailwind-merge");function l(...e){return(0,r.twMerge)((0,a.clsx)(e))}},41169:e=>{e.exports=require("class-variance-authority")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},16689:e=>{e.exports=require("react")},20997:e=>{e.exports=require("react/jsx-runtime")},11399:e=>{e.exports=require("sonner")},55315:e=>{e.exports=require("path")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[682,54],()=>s(70450));module.exports=a})();