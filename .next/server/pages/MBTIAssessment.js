"use strict";(()=>{var e={};e.id=965,e.ids=[965,660],e.modules={31130:(e,t,s)=>{s.r(t),s.d(t,{config:()=>P,default:()=>w,getServerSideProps:()=>k,getStaticPaths:()=>S,getStaticProps:()=>N,reportWebVitals:()=>_,routeModule:()=>q,unstable_getServerProps:()=>T,unstable_getServerSideProps:()=>M,unstable_getStaticParams:()=>z,unstable_getStaticPaths:()=>I,unstable_getStaticProps:()=>A});var r={};s.r(r),s.d(r,{default:()=>j});var a=s(87093),i=s(35244),o=s(1323),l=s(61682),n=s.n(l),c=s(48141),d=s.n(c),u=s(20997),m=s(16689),h=s(95189),x=s(9451),p=s(50083),g=s(99763),v=s(40594),f=s(39332),b=s(37568),y=s(11399);let j=()=>{let e=(0,f.useRouter)(),{user:t}=(0,b.a)(),[s,r]=(0,m.useState)([]),[a,i]=(0,m.useState)(""),[o,l]=(0,m.useState)(!1),[n,c]=(0,m.useState)(!0),[d,j]=(0,m.useState)(!1),[w,N]=(0,m.useState)([]),[S,k]=(0,m.useState)(null),[P,_]=(0,m.useState)(!1),A=(0,m.useRef)(null),I=()=>{A.current?.scrollIntoView({behavior:"smooth"})};(0,m.useEffect)(()=>{I()},[s]);let z=async()=>{try{let t=localStorage.getItem("token");if(!t){y.toast.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=await fetch("/api/assessment/start-mbti",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({})}),a=await s.json();if(a.success&&a.data){if(k(a.data.session_id),_(!0),j(!0),a.data.messages&&Array.isArray(a.data.messages)){let e=a.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));r(e)}c(!1),y.toast.success("آزمون MBTI شروع شد. می‌توانید پیام خود را ارسال کنید.")}else throw Error(a.message||"خطا در شروع جلسه چت")}catch(e){console.error("Error starting chat session:",e),y.toast.error("خطا در شروع آزمون MBTI. لطفاً دوباره تلاش کنید."),c(!1)}},T=()=>({start:"/api/assessment/start-mbti",chat:"/api/assessment/chat-mbti"}),M=async t=>{try{let s=localStorage.getItem("token");if(!s){y.toast.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}if(!S){y.toast.error("جلسه چت شروع نشده است");return}let a=T(),i=await fetch(a.chat,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({message:t,session_id:S})}),o=await i.json();if(o.success&&o.data){if(o.data.messages&&Array.isArray(o.data.messages)){let e=o.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));r(t=>[...t,...e])}"assessment_complete"===o.data.type&&(o.data.final_analysis?(localStorage.setItem("mbti_analysis",JSON.stringify(o.data.final_analysis)),e.push("/mbti-results")):(y.toast.success("آزمون MBTI تکمیل شد!"),setTimeout(()=>{e.push("/mbti-results")},3e3)))}else throw Error(o.message||"خطا در ارسال پیام")}catch(e){console.error("Error sending message:",e),y.toast.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید.")}finally{l(!1)}};(0,m.useEffect)(()=>{console.log("MBTI Assessment useEffect triggered:",{user:!!t,assessmentStarted:P}),t&&!P?z():t||e.push("/login")},[t,P,e]);let q=async()=>{if(!a.trim()||o)return;let e=a.trim();i("");let t={type:"user",content:e,timestamp:new Date};r(e=>[...e,t]),l(!0),await M(e)},C=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),y.toast.success("خروج موفقیت‌آمیز بود"),e.push("/mbti-results")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),y.toast.success("خروج انجام شد"),e.push("/mbti-results")}};return n?u.jsx("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/20 flex items-center justify-center",children:(0,u.jsxs)("div",{className:"text-center",children:[u.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl flex items-center justify-center mx-auto mb-4 animate-pulse",children:u.jsx(p.Z,{className:"w-8 h-8 text-white"})}),u.jsx("h2",{className:"text-2xl font-bold text-executive-charcoal mb-2",children:"در حال بارگذاری آزمون MBTI..."}),u.jsx("p",{className:"text-executive-ash",children:"لطفاً صبر کنید"})]})}):(0,u.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/20",children:[u.jsx("header",{className:"bg-white/90 backdrop-blur-xl border-b border-executive-ash-light/30 sticky top-0 z-50",children:(0,u.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center gap-4",children:[(0,u.jsxs)(h.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/"),className:"text-executive-ash hover:text-executive-charcoal",children:[u.jsx(g.Z,{className:"w-5 h-5 ml-2"}),"بازگشت"]}),(0,u.jsxs)("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-700 rounded-xl flex items-center justify-center",children:u.jsx(p.Z,{className:"w-5 h-5 text-white"})}),(0,u.jsxs)("div",{children:[u.jsx("h1",{className:"text-lg font-bold text-executive-charcoal",children:"آزمون شخصیت MBTI"}),u.jsx("p",{className:"text-sm text-executive-ash",children:d?"متصل":"در حال اتصال..."})]})]})]}),(0,u.jsxs)("div",{className:"flex items-center gap-3",children:[(0,u.jsxs)("div",{className:"text-right",children:[(0,u.jsxs)("p",{className:"text-sm font-medium text-executive-charcoal",children:[t?.first_name," ",t?.last_name]}),u.jsx("p",{className:"text-xs text-executive-ash",children:t?.email})]}),u.jsx(h.z,{variant:"outline",size:"sm",onClick:C,className:"border-executive-ash-light text-executive-ash hover:bg-executive-ash-light/10",children:"خروج"})]})]})}),u.jsx("main",{className:"max-w-4xl mx-auto px-4 py-6",children:(0,u.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-3xl shadow-luxury border border-executive-ash-light/30 overflow-hidden",children:[(0,u.jsxs)("div",{className:"h-96 overflow-y-auto p-6 space-y-4",children:[s.map((e,t)=>u.jsx("div",{className:`flex ${"user"===e.type?"justify-end":"justify-start"}`,children:(0,u.jsxs)("div",{className:`max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${"user"===e.type?"bg-gradient-to-r from-purple-500 to-purple-700 text-white":"bg-executive-ash-light/20 text-executive-charcoal border border-executive-ash-light/50"}`,children:[e.character&&"user"!==e.type&&u.jsx("p",{className:"text-xs font-medium mb-1 opacity-70",children:e.character}),u.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),u.jsx("p",{className:"text-xs mt-2 opacity-60",children:e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})},t)),o&&u.jsx("div",{className:"flex justify-start",children:u.jsx("div",{className:"bg-executive-ash-light/20 border border-executive-ash-light/50 px-4 py-3 rounded-2xl",children:(0,u.jsxs)("div",{className:"flex space-x-1",children:[u.jsx("div",{className:"w-2 h-2 bg-executive-ash rounded-full animate-bounce"}),u.jsx("div",{className:"w-2 h-2 bg-executive-ash rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),u.jsx("div",{className:"w-2 h-2 bg-executive-ash rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),u.jsx("div",{ref:A})]}),u.jsx("div",{className:"border-t border-executive-ash-light/30 p-6",children:(0,u.jsxs)("div",{className:"flex gap-3",children:[u.jsx(x.g,{value:a,onChange:e=>i(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),q())},placeholder:"پیام خود را بنویسید...",className:"flex-1 min-h-[60px] resize-none border-executive-ash-light/50 focus:border-purple-500/50 focus:ring-purple-500/20",disabled:o}),u.jsx(h.z,{onClick:q,disabled:!a.trim()||o,className:"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300",children:u.jsx(v.Z,{className:"w-5 h-5"})})]})})]})})]})},w=(0,o.l)(r,"default"),N=(0,o.l)(r,"getStaticProps"),S=(0,o.l)(r,"getStaticPaths"),k=(0,o.l)(r,"getServerSideProps"),P=(0,o.l)(r,"config"),_=(0,o.l)(r,"reportWebVitals"),A=(0,o.l)(r,"unstable_getStaticProps"),I=(0,o.l)(r,"unstable_getStaticPaths"),z=(0,o.l)(r,"unstable_getStaticParams"),T=(0,o.l)(r,"unstable_getServerProps"),M=(0,o.l)(r,"unstable_getServerSideProps"),q=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/MBTIAssessment",pathname:"/MBTIAssessment",bundlePath:"",filename:""},components:{App:d(),Document:n()},userland:r})},33592:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(16689);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:l="",children:n,iconNode:c,...d},u)=>(0,r.createElement)("svg",{ref:u,...o,width:t,height:t,stroke:e,strokeWidth:a?24*Number(s)/Number(t):s,className:i("lucide",l),...d},[...c.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(n)?n:[n]])),n=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...o},n)=>(0,r.createElement)(l,{ref:n,iconNode:t,className:i(`lucide-${a(e)}`,s),...o}));return s.displayName=`${e}`,s}},99763:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(33592).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},50083:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(33592).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},40594:(e,t,s)=>{s.d(t,{Z:()=>r});let r=(0,s(33592).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},95189:(e,t,s)=>{s.d(t,{z:()=>c});var r=s(20997),a=s(16689);let i=require("@radix-ui/react-slot");var o=s(41169),l=s(51093);let n=(0,o.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef(({className:e,variant:t,size:s,asChild:a=!1,...o},c)=>{let d=a?i.Slot:"button";return r.jsx(d,{className:(0,l.cn)(n({variant:t,size:s,className:e})),ref:c,...o})});c.displayName="Button"},9451:(e,t,s)=>{s.d(t,{g:()=>o});var r=s(20997),a=s(16689),i=s(51093);let o=a.forwardRef(({className:e,...t},s)=>r.jsx("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));o.displayName="Textarea"},37568:(e,t,s)=>{s.d(t,{a:()=>i}),s(20997);var r=s(16689);let a=(0,r.createContext)(void 0),i=()=>{let e=(0,r.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},51093:(e,t,s)=>{s.d(t,{cn:()=>i});let r=require("clsx"),a=require("tailwind-merge");function i(...e){return(0,a.twMerge)((0,r.clsx)(e))}},41169:e=>{e.exports=require("class-variance-authority")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},62785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},16689:e=>{e.exports=require("react")},20997:e=>{e.exports=require("react/jsx-runtime")},11399:e=>{e.exports=require("sonner")},55315:e=>{e.exports=require("path")}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[682,54],()=>s(31130));module.exports=r})();