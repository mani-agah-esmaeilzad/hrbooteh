(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[326],{5372:function(e,t,a){Promise.resolve().then(a.bind(a,5963))},2381:function(e,t,a){"use strict";a.d(t,{z:function(){return c}});var r=a(7437),s=a(2265),i=a(7053),n=a(535),l=a(3448);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:c=!1,...d}=e,u=c?i.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:s,size:n,className:a})),ref:t,...d})});c.displayName="Button"},3675:function(e,t,a){"use strict";a.d(t,{g:function(){return n}});var r=a(7437),s=a(2265),i=a(3448);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});n.displayName="Textarea"},4362:function(e,t,a){"use strict";a.d(t,{H:function(){return n},a:function(){return l}});var r=a(7437),s=a(2265);let i=(0,s.createContext)(void 0),n=e=>{let{children:t}=e,[a,n]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[u,x]=(0,s.useState)(1);return(0,s.useEffect)(()=>{try{let e=localStorage.getItem("user");e&&n(JSON.parse(e))}catch(e){console.error("Error loading user from localStorage:",e)}},[]),(0,r.jsx)(i.Provider,{value:{user:a,setUser:e=>{n(e);try{e?localStorage.setItem("user",JSON.stringify(e)):localStorage.removeItem("user")}catch(e){console.error("Error saving user to localStorage:",e)}},selectedSkillId:l,setSelectedSkillId:o,currentAssessmentId:c,setCurrentAssessmentId:d,currentQuestionnaire:u,setCurrentQuestionnaire:x},children:t})},l=()=>{let e=(0,s.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var r=a(1994),s=a(3335);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.m6)((0,r.W)(t))}},5963:function(e,t,a){"use strict";a.d(t,{default:function(){return p}});var r=a(7437),s=a(2265),i=a(2381),n=a(3675),l=a(2718),o=a(2660),c=a(5805),d=a(8906),u=a(4743),x=a(9376),m=a(4362),h=a(4438),v=a(4106),f={src:"/_next/static/media/ai-character.6924bf46.png"},g={src:"/_next/static/media/user-character.14316580.png"},b=e=>{let{type:t,isTyping:a=!1,isSpeaking:s=!1}=e;return(0,r.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,r.jsxs)(v.E.div,{className:"relative w-16 h-16 sm:w-24 sm:h-24 rounded-full overflow-hidden bg-gradient-to-br from-white to-executive-pearl shadow-xl border-2 border-white",animate:s?{y:[0,-10,0],scale:[1,1.05,1],rotateZ:[0,2,-2,0]}:{scale:[1,1.01,1],y:[0,-1,0]},transition:s?{duration:.8,repeat:1/0,ease:"easeInOut"}:{duration:3,repeat:1/0,ease:"easeInOut"},style:{filter:"drop-shadow(0 6px 15px rgba(0,0,0,0.15))"},children:[(0,r.jsx)(v.E.img,{src:("ai"===t?f:g).src,alt:"".concat(t," character"),className:"w-full h-full object-cover",animate:s?{scale:[1,1.03,1]}:{},transition:{duration:.5,repeat:1/0}}),a&&(0,r.jsx)(v.E.div,{className:"absolute -bottom-2 -right-2 w-6 h-6 bg-executive-navy rounded-full flex items-center justify-center shadow-md",animate:{scale:[1,1.2,1],rotateZ:[0,8,-8,0]},transition:{duration:1,repeat:1/0},children:(0,r.jsx)("div",{className:"flex space-x-0.5",children:[0,.2,.4].map((e,t)=>(0,r.jsx)(v.E.div,{className:"w-1 h-1 bg-white rounded-full",animate:{opacity:[.3,1,.3],y:[0,-1.5,0]},transition:{duration:1,repeat:1/0,delay:e}},t))})}),s&&(0,r.jsx)(v.E.div,{className:"absolute inset-0 bg-gradient-to-br from-executive-gold/20 to-executive-navy/20 rounded-full",animate:{opacity:[.3,.6,.3]},transition:{duration:1,repeat:1/0}})]}),(0,r.jsx)(v.E.div,{className:"mt-2 px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow text-center ".concat("ai"===t?"bg-gradient-to-r from-executive-navy to-executive-navy-light text-white":"bg-gradient-to-r from-executive-gold to-executive-gold-light text-executive-charcoal"),animate:s?{scale:[1,1.05,1],boxShadow:["0 2px 10px rgba(0,0,0,0.15)","0 4px 15px rgba(0,0,0,0.25)","0 2px 10px rgba(0,0,0,0.15)"]}:{},transition:{duration:.8,repeat:s?1/0:0},children:"ai"===t?"\uD83E\uDD16 مشاور":"\uD83D\uDC64 شما"}),s&&(0,r.jsx)("div",{className:"absolute -z-10",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsx)(v.E.div,{className:"absolute w-16 h-16 sm:w-24 sm:h-24 border-2 border-executive-gold/30 rounded-full",style:{left:"50%",top:"50%",marginLeft:"-2rem",marginTop:"-2rem"},animate:{scale:[1,2.5],opacity:[.5,0]},transition:{duration:2,repeat:1/0,delay:.6*t,ease:"easeOut"}},t))})]})},p=()=>{let e=(0,x.useRouter)(),{user:t,currentQuestionnaire:a}=(0,m.a)(),[v,f]=(0,s.useState)([]),[g,p]=(0,s.useState)(""),[y,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)(!0),[S,k]=(0,s.useState)(!1),[A,E]=(0,s.useState)([]),[I,C]=(0,s.useState)(null),[_,z]=(0,s.useState)(!1),D=(0,s.useRef)(null),T=(0,s.useRef)(!1),O=async()=>{let t=localStorage.getItem("token");if(!t){h.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let r=R(a);if(!r||!r.start){h.Am.error("پرسشنامه انتخاب شده معتبر نیست."),e.push("/");return}try{var s,i;N(!0);let e=await fetch(r.start,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!e.ok)throw Error("خطای سرور: ".concat(e.statusText));let a=await e.json();if((null===(s=a.data)||void 0===s?void 0:s.session_id)?C(a.data.session_id):a.session_id&&C(a.session_id),(null===(i=a.data)||void 0===i?void 0:i.messages)&&Array.isArray(a.data.messages)){let e=a.data.messages.map(e=>({type:"ai1",content:e.content,timestamp:new Date,character:e.character}));f(e);let t=Array.from(new Set(a.data.messages.map(e=>e.character).filter(Boolean)));t.length>=2&&E(t.slice(0,2))}N(!1),k(!0),z(!0),T.current=!0,h.Am.success("جلسه چت شروع شد. می‌توانید پیام خود را ارسال کنید.")}catch(e){h.Am.error("خطا در شروع جلسه چت. لطفاً دوباره تلاش کنید."),N(!1)}},R=e=>{if(!e||isNaN(Number(e)))return console.warn("Invalid questionnaireId:",e),{start:"/api/assessment/start-independence",chat:"/api/assessment/chat-independence"};switch(Number(e)){case 1:default:return{start:"/api/assessment/start-independence",chat:"/api/assessment/chat-independence"};case 2:return{start:"/api/assessment/start-mbti",chat:"/api/assessment/chat-mbti"}}};(0,s.useEffect)(()=>{var e;null===(e=D.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[v]),(0,s.useEffect)(()=>{if(console.log("Assessment useEffect triggered:",{user:!!t,currentQuestionnaire:a,assessmentStarted:_}),t&&a&&"number"==typeof a&&!_&&!T.current)return T.current=!0,O(),()=>{T.current=!1}},[null==t?void 0:t.id,a]);let Z=t=>{let a=t.data||t;if(a.analysis){h.Am.info("ارزیابی تکمیل شد!"),e.push("/results");return}if(Array.isArray(a.messages)&&a.messages.length>0){let e=A;if(0===e.length){let t=Array.from(new Set(a.messages.map(e=>e.character).filter(Boolean)));t.length>=2&&(E(t.slice(0,2)),e=t.slice(0,2))}let t=[];a.messages.forEach(a=>{let r="ai1";e.length>=2&&(r=a.character===e[1]?"ai2":"ai1");let s={type:r,content:a.content,timestamp:new Date,character:a.character};t.push(s)});let r=0;t.forEach((e,a)=>{setTimeout(()=>{f(t=>t.some(t=>t.content===e.content&&t.type===e.type)?t:[...t,e]),a===t.length-1&&j(!1)},r),r+=1500})}else if(a.message){let e={type:"ai1",content:a.message,timestamp:new Date,character:"AI"};f(t=>[...t,e]),j(!1)}else j(!1),h.Am.error("پاسخ دریافتی از سرور معتبر نبود.")},B=async t=>{if(!I){h.Am.error("خطای Session. لطفاً صفحه را رفرش کنید."),j(!1);return}let r=localStorage.getItem("token");if(!r){h.Am.error("توکن منقضی شده. لطفاً دوباره وارد شوید"),e.push("/login");return}let s=R(a);if(!s||!s.chat){h.Am.error("خطای جلسه چت."),j(!1);return}try{let a=await fetch(s.chat,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({message:t,session_id:I})});if(!a.ok){if(401===a.status){h.Am.error("توکن منقضی شده. لطفاً دوباره وارد شوید"),localStorage.removeItem("token"),e.push("/login");return}throw Error("خطای سرور: ".concat(a.statusText))}let i=await a.json();Z(i)}catch(e){h.Am.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید."),j(!1)}},P=async()=>{if(!g.trim()||y||!S)return;let e={type:"user",content:g,timestamp:new Date};f(t=>[...t,e]),p(""),j(!0),await B(g)},L=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/"),h.Am.success("خروج موفقیت‌آمیز بود")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/"),h.Am.success("خروج انجام شد")}};return t?a?w?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/30 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-3xl p-12 shadow-luxury border border-white/20 text-center max-w-md",children:[(0,r.jsx)("div",{className:"w-24 h-24 mx-auto mb-8 bg-gradient-to-br from-executive-navy to-executive-navy-light rounded-3xl flex items-center justify-center animate-pulse shadow-2xl",children:(0,r.jsx)(l.Z,{className:"w-12 h-12 text-white"})}),(0,r.jsx)("h2",{className:"text-3xl font-bold text-executive-charcoal mb-6",children:"در حال اتصال به سرور..."}),(0,r.jsx)("p",{className:"text-lg text-executive-ash mb-8",children:"لطفاً کمی صبر کنید"}),(0,r.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-executive-navy rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-3 h-3 bg-executive-navy rounded-full animate-bounce delay-150"}),(0,r.jsx)("div",{className:"w-3 h-3 bg-executive-navy rounded-full animate-bounce delay-300"})]})]})}):(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-executive-pearl via-white to-executive-silver/20",children:[(0,r.jsx)("header",{className:"bg-white/95 backdrop-blur-xl border-b border-executive-ash-light/30 p-3 sticky top-0 z-50 shadow-subtle",children:(0,r.jsxs)("div",{className:"flex items-center justify-between max-w-full mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{onClick:()=>e.push("/"),className:"w-8 h-8 bg-executive-ash-light/50 rounded-lg flex items-center justify-center hover:bg-executive-navy/10 transition-all duration-300 group",children:(0,r.jsx)(o.Z,{className:"w-4 h-4 text-executive-ash group-hover:text-executive-navy"})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-executive-navy to-executive-navy-light rounded-xl flex items-center justify-center",children:(0,r.jsx)(c.Z,{className:"w-4 h-4 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-sm font-bold text-executive-charcoal",children:["جلسه تعاملی - پرسشنامه ",a]}),(0,r.jsx)("div",{className:"flex items-center gap-2 text-xs",children:A.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-1 ".concat(0===t?"text-blue-600":"text-green-600"),children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(S?0===t?"bg-blue-500":"bg-green-500":"bg-gray-400"," animate-pulse")}),(0,r.jsx)("span",{className:"font-medium",children:e})]},t))})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-executive-gold-light/20 px-3 py-1 rounded-lg border border-executive-gold/20",children:[(0,r.jsx)(d.Z,{className:"w-3 h-3 text-executive-gold"}),(0,r.jsx)("span",{className:"text-xs font-bold text-executive-charcoal",children:"امن"})]}),(0,r.jsx)(i.z,{onClick:L,variant:"outline",size:"sm",className:"bg-white/80 hover:bg-red-50 border-red-200 text-red-600 hover:text-red-700 hover:border-red-300 transition-all duration-300",children:"خروج"})]})]})}),(0,r.jsx)("main",{className:"flex-1 overflow-y-auto p-3",children:(0,r.jsxs)("div",{className:"max-w-full mx-auto space-y-3",children:[v.map((e,t)=>{var a,s;return(0,r.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"," mb-4"),children:"user"!==e.type?(0,r.jsxs)("div",{className:"flex items-start gap-2 max-w-[85%]",children:[(0,r.jsx)("div",{className:"flex-shrink-0 mt-1",children:(0,r.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full overflow-hidden bg-executive-navy flex items-center justify-center text-white text-xs font-bold shadow-md",children:null!==(s=null===(a=e.character)||void 0===a?void 0:a.charAt(0).toUpperCase())&&void 0!==s?s:"A"})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[e.character&&(0,r.jsx)("span",{className:"text-xs font-semibold text-executive-charcoal bg-white/80 px-2 py-0.5 rounded-full border border-executive-ash-light/40 mb-1 self-start",children:e.character}),(0,r.jsxs)("div",{className:"rounded-2xl p-3 shadow-sm ".concat("ai1"===e.type?"bg-gradient-to-br from-blue-50 to-blue-100/60 border border-blue-200/60 rounded-bl-md":"bg-gradient-to-br from-green-50 to-green-100/60 border border-green-200/60 rounded-bl-md"),children:[(0,r.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-line text-executive-charcoal",children:e.content}),(0,r.jsx)("p",{className:"text-xs mt-1 text-executive-ash/70",children:e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})]})]}):(0,r.jsxs)("div",{className:"max-w-[85%] bg-gradient-to-br from-executive-gold/15 to-executive-gold-light/25 border border-executive-gold/30 rounded-2xl rounded-br-md p-3 shadow-sm",children:[(0,r.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-line text-executive-charcoal",children:e.content}),(0,r.jsx)("p",{className:"text-xs mt-1 text-executive-ash/70",children:e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})},t)}),y&&(0,r.jsx)("div",{className:"flex justify-start mb-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-2 max-w-[85%]",children:[(0,r.jsx)("div",{className:"w-4 h-4 flex-shrink-0 mt-1",children:(0,r.jsx)(b,{type:"ai",isTyping:!0,isSpeaking:!1})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-xs font-semibold text-executive-charcoal bg-white/80 px-2 py-0.5 rounded-full border border-executive-ash-light/40 mb-1 self-start",children:"در حال تایپ..."}),(0,r.jsx)("div",{className:"bg-white/95 border border-executive-ash-light/40 rounded-2xl rounded-bl-md p-3 shadow-sm animate-pulse",children:(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-executive-navy rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-executive-navy rounded-full animate-bounce delay-150"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-executive-navy rounded-full animate-bounce delay-300"})]})})]})]})}),(0,r.jsx)("div",{ref:D})]})}),(0,r.jsx)("footer",{className:"p-3 bg-white/95 backdrop-blur-xl border-t border-executive-ash-light/30",children:(0,r.jsxs)("div",{className:"max-w-full mx-auto",children:[(0,r.jsxs)("div",{className:"flex gap-2 items-end mb-3",children:[(0,r.jsx)(n.g,{value:g,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},placeholder:"پاسخ خود را بنویسید...",className:"flex-1 min-h-[60px] max-h-[120px] text-sm p-3 rounded-2xl border border-executive-ash-light/50 focus:border-executive-navy resize-none bg-white/90 backdrop-blur-sm shadow-md transition-all duration-300",disabled:y||!S}),(0,r.jsx)(i.z,{onClick:P,disabled:!g.trim()||y||!S,className:"w-12 h-12 bg-gradient-to-br from-executive-navy to-executive-navy-light hover:from-executive-navy-dark hover:to-executive-navy rounded-2xl p-0 shadow-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:transform-none",children:(0,r.jsx)(u.Z,{className:"w-5 h-5 text-white"})})]}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{className:"text-xs text-executive-ash bg-executive-ash-light/20 px-3 py-2 rounded-lg inline-block",children:"\uD83D\uDCAC جلسه ارزیابی زنده"})})]})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/30 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-executive-charcoal mb-4",children:"پرسشنامه انتخاب نشده"}),(0,r.jsx)("p",{className:"text-executive-ash mb-6",children:"لطفاً ابتدا یک پرسشنامه انتخاب کنید"}),(0,r.jsx)(i.z,{onClick:()=>e.push("/"),className:"bg-executive-navy text-white",children:"بازگشت به صفحه اصلی"})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/30 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-executive-charcoal mb-4",children:"دسترسی محدود"}),(0,r.jsx)("p",{className:"text-executive-ash mb-6",children:"برای دسترسی به این صفحه باید وارد شوید"}),(0,r.jsx)(i.z,{onClick:()=>e.push("/login"),className:"bg-executive-navy text-white",children:"ورود به سیستم"})]})})}}},function(e){e.O(0,[569,438,314,971,117,744],function(){return e(e.s=5372)}),_N_E=e.O()}]);