(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{3995:function(e,t,s){Promise.resolve().then(s.bind(s,4231))},9205:function(e,t,s){"use strict";s.d(t,{Z:function(){return i}});var a=s(2265);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,a.forwardRef)((e,t)=>{let{color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...l,width:r,height:r,stroke:s,strokeWidth:i?24*Number(o)/Number(r):o,className:n("lucide",c),...m},[...u.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let s=(0,a.forwardRef)((s,l)=>{let{className:i,...c}=s;return(0,a.createElement)(o,{ref:l,iconNode:t,className:n("lucide-".concat(r(e)),i),...c})});return s.displayName="".concat(e),s}},2660:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},2718:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]])},4743:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(9205).Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},9376:function(e,t,s){"use strict";var a=s(5475);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return c}});var a=s(7437),r=s(2265),n=s(7053),l=s(535),o=s(3448);let i=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:c=!1,...d}=e,u=c?n.g7:"button";return(0,a.jsx)(u,{className:(0,o.cn)(i({variant:r,size:l,className:s})),ref:t,...d})});c.displayName="Button"},3675:function(e,t,s){"use strict";s.d(t,{g:function(){return l}});var a=s(7437),r=s(2265),n=s(3448);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});l.displayName="Textarea"},4362:function(e,t,s){"use strict";s.d(t,{H:function(){return l},a:function(){return o}});var a=s(7437),r=s(2265);let n=(0,r.createContext)(void 0),l=e=>{let{children:t}=e,[s,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(1);return(0,r.useEffect)(()=>{try{let e=localStorage.getItem("user");e&&l(JSON.parse(e))}catch(e){console.error("Error loading user from localStorage:",e)}},[]),(0,a.jsx)(n.Provider,{value:{user:s,setUser:e=>{l(e);try{e?localStorage.setItem("user",JSON.stringify(e)):localStorage.removeItem("user")}catch(e){console.error("Error saving user to localStorage:",e)}},selectedSkillId:o,setSelectedSkillId:i,currentAssessmentId:c,setCurrentAssessmentId:d,currentQuestionnaire:u,setCurrentQuestionnaire:m},children:t})},o=()=>{let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3448:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var a=s(1994),r=s(3335);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.m6)((0,a.W)(t))}},4231:function(e,t,s){"use strict";s.d(t,{default:function(){return g}});var a=s(7437),r=s(2265),n=s(2381),l=s(3675),o=s(9205);let i=(0,o.Z)("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var c=s(2660);let d=(0,o.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var u=s(2718),m=s(4743),x=s(9376),h=s(4362),f=s(4438),g=()=>{let e=(0,x.useRouter)(),{user:t}=(0,h.a)(),[s,o]=(0,r.useState)([]),[g,p]=(0,r.useState)(""),[b,v]=(0,r.useState)(!1),[y,j]=(0,r.useState)(!0),[N,w]=(0,r.useState)(!1),[k,S]=(0,r.useState)(null),[D,C]=(0,r.useState)(!1),[A,_]=(0,r.useState)(null),I=[{name:"آقای توحیدی",role:"مدیر بخش",avatar:"\uD83D\uDC68‍\uD83D\uDCBC",position:{x:50,y:15},color:"from-blue-500 to-blue-600"},{name:"سارا",role:"طراح تیم",avatar:"\uD83D\uDC69‍\uD83D\uDCBB",position:{x:20,y:50},color:"from-pink-500 to-pink-600"},{name:"احمد",role:"مسئول کیفیت",avatar:"\uD83D\uDC68‍\uD83D\uDD27",position:{x:80,y:50},color:"from-green-500 to-green-600"},{name:"خانم نوروزی",role:"بخش مالی",avatar:"\uD83D\uDC69‍\uD83D\uDCBC",position:{x:50,y:85},color:"from-purple-500 to-purple-600"},{name:(null==t?void 0:t.first_name)||"شما",role:"سرپرست جدید",avatar:"\uD83C\uDFAF",position:{x:50,y:50},color:"from-orange-500 to-orange-600"}],z=async()=>{try{let t=localStorage.getItem("token");if(!t){f.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=await fetch("/api/assessment/start-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({})}),a=await s.json();if(a.success&&a.data){if(S(a.data.session_id),C(!0),w(!0),a.data.messages&&Array.isArray(a.data.messages)){let e=a.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)}));o(e)}j(!1),f.Am.success("جلسه کاری شروع شد. می‌توانید در بحث شرکت کنید.")}else throw Error(a.message||"خطا در شروع جلسه")}catch(e){console.error("Error starting chat session:",e),f.Am.error("خطا در شروع جلسه. لطفاً دوباره تلاش کنید."),j(!1)}},E=async t=>{try{let s=localStorage.getItem("token");if(!s){f.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}if(!k){f.Am.error("جلسه شروع نشده است");return}let a=await fetch("/api/assessment/chat-independence",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({message:t,session_id:k})}),r=await a.json();if(r.success&&r.data){if(r.data.messages&&Array.isArray(r.data.messages)&&r.data.messages.map(e=>({type:e.type,content:e.content,character:e.character,timestamp:new Date(e.timestamp)})).forEach((e,t)=>{setTimeout(()=>{o(t=>[...t,e]),_(e.character||null),setTimeout(()=>_(null),3e3)},1e3*t)}),"assessment_complete"===r.data.type||"ارزیابی تکمیل شد"===r.message){f.Am.success("ارزیابی استقلال تکمیل شد!"),(r.data.analysis||r.data)&&localStorage.setItem("independence_results",JSON.stringify({assessment_id:k,final_analysis:r.data.analysis||r.data,completed_at:new Date().toISOString(),questionnaire_type:"independence"})),setTimeout(()=>{e.push("/results")},2e3);return}}else throw Error(r.message||"خطا در ارسال پیام")}catch(e){console.error("Error sending message:",e),f.Am.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید.")}finally{v(!1)}};(0,r.useEffect)(()=>{t&&!D?z():t||e.push("/login")},[t,D,e]);let Z=async()=>{if(!g.trim()||b)return;let e=g.trim();p("");let s={type:"user",content:e,timestamp:new Date};o(e=>[...e,s]),_((null==t?void 0:t.first_name)||"شما"),v(!0),setTimeout(()=>_(null),3e3),await E(e)},O=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),f.Am.success("خروج موفقیت‌آمیز بود"),e.push("/")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),f.Am.success("خروج انجام شد"),e.push("/")}},T=e=>{var a;let r=s.filter(s=>s.character===e||"user"===s.type&&e===((null==t?void 0:t.first_name)||"شما"));return(null===(a=r[r.length-1])||void 0===a?void 0:a.content)||""};return y?(0,a.jsx)("div",{className:"min-h-screen meeting-room flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center animate-slideIn",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-pulse character-avatar",children:(0,a.jsx)(i,{className:"w-10 h-10 text-white"})}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-white mb-3",children:"در حال آماده‌سازی اتاق جلسه..."}),(0,a.jsx)("p",{className:"text-slate-300 text-lg",children:"تنظیمات صفحه در حال بارگذاری"}),(0,a.jsx)("div",{className:"mt-4 flex justify-center",children:(0,a.jsxs)("div",{className:"typing-dots",children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{}),(0,a.jsx)("div",{})]})})]})}):(0,a.jsxs)("div",{className:"min-h-screen meeting-room",children:[(0,a.jsx)("header",{className:"bg-slate-800/95 backdrop-blur-xl border-b border-slate-600/40 sticky top-0 z-50 shadow-2xl",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/"),className:"text-slate-300 hover:text-white hover:bg-slate-700/50 transition-all duration-200",children:[(0,a.jsx)(c.Z,{className:"w-5 h-5 ml-2"}),"بازگشت"]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(i,{className:"w-6 h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-white",children:"جلسه ارزیابی استقلال"}),(0,a.jsxs)("p",{className:"text-sm text-slate-300 flex items-center gap-2",children:[(0,a.jsx)(d,{className:"w-4 h-4"}),N?"جلسه در حال برگزاری":"در حال اتصال..."]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-white",children:[null==t?void 0:t.first_name," ",null==t?void 0:t.last_name]}),(0,a.jsx)("p",{className:"text-xs text-slate-300",children:null==t?void 0:t.email})]}),(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:O,className:"border-slate-600 text-slate-300 hover:bg-slate-700 hover:text-white transition-all duration-200",children:"خروج"})]})]})}),(0,a.jsx)("main",{className:"flex-1 p-6",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8 animate-fadeIn",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-white mb-3",children:"\uD83C\uDFE2 اتاق کنفرانس شرکت"}),(0,a.jsx)("p",{className:"text-slate-300 text-lg",children:"شما در جلسه‌ای برای بررسی پروژه مهم شرکت حضور دارید"})]}),(0,a.jsxs)("div",{className:"relative meeting-room rounded-3xl shadow-2xl border border-slate-500/30 overflow-hidden animate-slideIn",style:{height:"650px"},children:[(0,a.jsxs)("div",{className:"absolute inset-6 table-surface rounded-2xl border border-amber-700/50 shadow-inner",children:[(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-gradient-to-br from-amber-600/30 to-amber-800/40 rounded-full border-2 border-amber-500/50"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-radial from-amber-300/5 via-transparent to-transparent"})]}),I.map((e,s)=>{let r=T(e.name),n=e.name===((null==t?void 0:t.first_name)||"شما"),l=A===e.name;return(0,a.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 animate-fadeIn",style:{left:"".concat(e.position.x,"%"),top:"".concat(e.position.y,"%"),animationDelay:"".concat(.2*s,"s")},children:[r&&(0,a.jsx)("div",{className:"absolute bottom-full mb-6 left-1/2 transform -translate-x-1/2 animate-slideIn z-10",children:(0,a.jsxs)("div",{className:"speech-bubble",children:[(0,a.jsx)("p",{className:"text-slate-800 text-sm leading-relaxed font-medium",children:r}),(0,a.jsx)("div",{className:"absolute -top-2 left-3 bg-slate-700 text-white text-xs px-2 py-1 rounded-full",children:e.name})]})}),(0,a.jsxs)("div",{className:"relative group character-avatar ".concat(n?"ring-4 ring-orange-400/60":""," ").concat(l?"animate-pulse":""),children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br ".concat(e.color," rounded-full shadow-2xl flex items-center justify-center text-3xl border-4 border-white/20 ").concat(l?"ring-4 ring-blue-400 ring-opacity-75":""),children:e.avatar}),(0,a.jsxs)("div",{className:"absolute top-full mt-3 left-1/2 transform -translate-x-1/2 text-center min-w-max",children:[(0,a.jsx)("p",{className:"text-white font-bold text-sm bg-slate-800/80 px-3 py-1 rounded-full border border-slate-600/50",children:e.name}),(0,a.jsx)("p",{className:"text-slate-300 text-xs mt-1",children:e.role})]}),b&&!n&&(0,a.jsx)("div",{className:"absolute -top-3 -right-3 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center shadow-lg animate-bounce",children:(0,a.jsxs)("div",{className:"typing-dots",children:[(0,a.jsx)("div",{className:"w-1 h-1"}),(0,a.jsx)("div",{className:"w-1 h-1"}),(0,a.jsx)("div",{className:"w-1 h-1"})]})}),n&&(0,a.jsx)("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]})]},s)}),(0,a.jsxs)("div",{className:"absolute top-6 right-6 bg-black/40 backdrop-blur-sm rounded-xl px-4 py-3 border border-slate-600/30",children:[(0,a.jsxs)("p",{className:"text-white text-sm font-semibold flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"پیام‌ها: ",s.length]}),(0,a.jsxs)("p",{className:"text-slate-300 text-xs mt-1",children:["شرکت‌کنندگان: ",I.length]})]}),(0,a.jsx)("div",{className:"absolute top-6 left-6 w-12 h-12 bg-gradient-to-br from-yellow-400/20 to-amber-600/30 rounded-full border border-yellow-500/30 animate-pulse",title:"نور اتاق"})]}),(0,a.jsx)("div",{className:"mt-8 bg-slate-800/60 backdrop-blur-xl rounded-2xl p-6 border border-slate-600/40 shadow-2xl animate-fadeIn",children:(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"نظر شما در جلسه:"}),(0,a.jsx)(l.g,{value:g,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Z())},placeholder:"نظر خود را در جلسه بیان کنید...",className:"bg-slate-700/60 border-slate-600 text-white placeholder-slate-400 focus:border-blue-500 focus:ring-blue-500/30 min-h-[100px] resize-none text-base shadow-inner",disabled:b})]}),(0,a.jsx)("div",{className:"flex flex-col justify-end",children:(0,a.jsxs)(n.z,{onClick:Z,disabled:!g.trim()||b,className:"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white px-8 py-4 rounded-xl shadow-lg h-fit transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:[(0,a.jsx)(m.Z,{className:"w-5 h-5 ml-2"}),b?"در حال ارسال...":"صحبت کنید"]})})]})}),(0,a.jsxs)("div",{className:"mt-6 bg-slate-800/40 backdrop-blur-sm rounded-xl p-4 border border-slate-600/30 max-h-40 overflow-y-auto animate-fadeIn",children:[(0,a.jsxs)("h3",{className:"text-white font-semibold mb-3 flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-4 h-4"}),"تاریخچه صحبت‌های جلسه"]}),(0,a.jsxs)("div",{className:"space-y-2",children:[s.slice(-5).map((e,t)=>(0,a.jsxs)("div",{className:"text-slate-300 text-sm p-2 bg-slate-700/30 rounded-lg",children:[(0,a.jsxs)("span",{className:"font-medium text-blue-300",children:[e.character||("user"===e.type?"شما":"سیستم"),":"]}),(0,a.jsx)("span",{className:"mr-2",children:e.content}),(0,a.jsxs)("span",{className:"text-xs text-slate-400 mr-2",children:["(",e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"}),")"]})]},t)),0===s.length&&(0,a.jsx)("p",{className:"text-slate-400 text-center py-4",children:"هنوز صحبتی در جلسه نشده است..."})]})]})]})})]})}}},function(e){e.O(0,[569,438,971,117,744],function(){return e(e.s=3995)}),_N_E=e.O()}]);