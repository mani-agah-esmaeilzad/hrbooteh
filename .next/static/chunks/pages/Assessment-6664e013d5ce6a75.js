(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[355],{9290:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Assessment",function(){return a(93)}])},5364:function(e,t,a){"use strict";a.d(t,{z:function(){return o}});var s=a(5893),r=a(7294),i=a(8426),n=a(2003),l=a(7742);let c=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:o=!1,...d}=e,u=o?i.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(c({variant:r,size:n,className:a})),ref:t,...d})});o.displayName="Button"},9451:function(e,t,a){"use strict";a.d(t,{g:function(){return n}});var s=a(5893),r=a(7294),i=a(7742);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});n.displayName="Textarea"},7568:function(e,t,a){"use strict";a.d(t,{a:function(){return i}}),a(5893);var s=a(7294);let r=(0,s.createContext)(void 0),i=()=>{let e=(0,s.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7742:function(e,t,a){"use strict";a.d(t,{cn:function(){return i}});var s=a(512),r=a(8388);function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}},93:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(5893),r=a(7294),i=a(5364),n=a(9451),l=a(83),c=a(9763),o=a(6286),d=a(9911),u=a(594),x=a(9332),m=a(7568),h=a(4712),v=a(1813),f={src:"/_next/static/media/ai-character.6924bf46.png"},g={src:"/_next/static/media/user-character.14316580.png"},b=e=>{let{type:t,isTyping:a=!1,isSpeaking:r=!1}=e;return(0,s.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,s.jsxs)(v.E.div,{className:"relative w-16 h-16 sm:w-24 sm:h-24 rounded-full overflow-hidden bg-gradient-to-br from-white to-executive-pearl shadow-xl border-2 border-white",animate:r?{y:[0,-10,0],scale:[1,1.05,1],rotateZ:[0,2,-2,0]}:{scale:[1,1.01,1],y:[0,-1,0]},transition:r?{duration:.8,repeat:1/0,ease:"easeInOut"}:{duration:3,repeat:1/0,ease:"easeInOut"},style:{filter:"drop-shadow(0 6px 15px rgba(0,0,0,0.15))"},children:[(0,s.jsx)(v.E.img,{src:("ai"===t?f:g).src,alt:"".concat(t," character"),className:"w-full h-full object-cover",animate:r?{scale:[1,1.03,1]}:{},transition:{duration:.5,repeat:1/0}}),a&&(0,s.jsx)(v.E.div,{className:"absolute -bottom-2 -right-2 w-6 h-6 bg-executive-navy rounded-full flex items-center justify-center shadow-md",animate:{scale:[1,1.2,1],rotateZ:[0,8,-8,0]},transition:{duration:1,repeat:1/0},children:(0,s.jsx)("div",{className:"flex space-x-0.5",children:[0,.2,.4].map((e,t)=>(0,s.jsx)(v.E.div,{className:"w-1 h-1 bg-white rounded-full",animate:{opacity:[.3,1,.3],y:[0,-1.5,0]},transition:{duration:1,repeat:1/0,delay:e}},t))})}),r&&(0,s.jsx)(v.E.div,{className:"absolute inset-0 bg-gradient-to-br from-executive-gold/20 to-executive-navy/20 rounded-full",animate:{opacity:[.3,.6,.3]},transition:{duration:1,repeat:1/0}})]}),(0,s.jsx)(v.E.div,{className:"mt-2 px-3 py-1 rounded-full text-xs sm:text-sm font-bold shadow text-center ".concat("ai"===t?"bg-gradient-to-r from-executive-navy to-executive-navy-light text-white":"bg-gradient-to-r from-executive-gold to-executive-gold-light text-executive-charcoal"),animate:r?{scale:[1,1.05,1],boxShadow:["0 2px 10px rgba(0,0,0,0.15)","0 4px 15px rgba(0,0,0,0.25)","0 2px 10px rgba(0,0,0,0.15)"]}:{},transition:{duration:.8,repeat:r?1/0:0},children:"ai"===t?"\uD83E\uDD16 مشاور":"\uD83D\uDC64 شما"}),r&&(0,s.jsx)("div",{className:"absolute -z-10",children:[void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(v.E.div,{className:"absolute w-16 h-16 sm:w-24 sm:h-24 border-2 border-executive-gold/30 rounded-full",style:{left:"50%",top:"50%",marginLeft:"-2rem",marginTop:"-2rem"},animate:{scale:[1,2.5],opacity:[.5,0]},transition:{duration:2,repeat:1/0,delay:.6*t,ease:"easeOut"}},t))})]})},p=()=>{let e=(0,x.useRouter)(),{user:t,currentQuestionnaire:a}=(0,m.a)(),[v,f]=(0,r.useState)([]),[g,p]=(0,r.useState)(""),[y,w]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!0),[k,A]=(0,r.useState)(!1),[S,E]=(0,r.useState)([]),[_,C]=(0,r.useState)(null),[I,T]=(0,r.useState)(!1),z=(0,r.useRef)(null),D=(0,r.useRef)(!1),O=async()=>{let t=localStorage.getItem("token");if(!t){h.Am.error("لطفاً ابتدا وارد شوید"),e.push("/login");return}let s=R(a);if(!s||!s.start){h.Am.error("پرسشنامه انتخاب شده معتبر نیست."),e.push("/");return}try{var r,i;N(!0);let e=await fetch(s.start,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(!e.ok)throw Error("خطای سرور: ".concat(e.statusText));let a=await e.json();if((null===(r=a.data)||void 0===r?void 0:r.session_id)?C(a.data.session_id):a.session_id&&C(a.session_id),(null===(i=a.data)||void 0===i?void 0:i.messages)&&Array.isArray(a.data.messages)){let e=a.data.messages.map(e=>({type:"ai1",content:e.content,timestamp:new Date,character:e.character}));f(e);let t=Array.from(new Set(a.data.messages.map(e=>e.character).filter(Boolean)));t.length>=2&&E(t.slice(0,2))}N(!1),A(!0),T(!0),D.current=!0,h.Am.success("جلسه چت شروع شد. می‌توانید پیام خود را ارسال کنید.")}catch(e){h.Am.error("خطا در شروع جلسه چت. لطفاً دوباره تلاش کنید."),N(!1)}},R=e=>{if(!e||isNaN(Number(e)))return console.warn("Invalid questionnaireId:",e),{start:"/api/assessment/start-independence",chat:"/api/assessment/chat-independence"};switch(Number(e)){case 1:default:return{start:"/api/assessment/start-independence",chat:"/api/assessment/chat-independence"};case 2:return{start:"/api/assessment/start-mbti",chat:"/api/assessment/chat-mbti"}}};(0,r.useEffect)(()=>{var e;null===(e=z.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[v]),(0,r.useEffect)(()=>{if(console.log("Assessment useEffect triggered:",{user:!!t,currentQuestionnaire:a,assessmentStarted:I}),t&&a&&"number"==typeof a&&!I&&!D.current)return D.current=!0,O(),()=>{D.current=!1}},[null==t?void 0:t.id,a]);let Z=t=>{let a=t.data||t;if(a.analysis){h.Am.info("ارزیابی تکمیل شد!"),e.push("/results");return}if(Array.isArray(a.messages)&&a.messages.length>0){let e=S;if(0===e.length){let t=Array.from(new Set(a.messages.map(e=>e.character).filter(Boolean)));t.length>=2&&(E(t.slice(0,2)),e=t.slice(0,2))}let t=[];a.messages.forEach(a=>{let s="ai1";e.length>=2&&(s=a.character===e[1]?"ai2":"ai1");let r={type:s,content:a.content,timestamp:new Date,character:a.character};t.push(r)});let s=0;t.forEach((e,a)=>{setTimeout(()=>{f(t=>t.some(t=>t.content===e.content&&t.type===e.type)?t:[...t,e]),a===t.length-1&&w(!1)},s),s+=1500})}else if(a.message){let e={type:"ai1",content:a.message,timestamp:new Date,character:"AI"};f(t=>[...t,e]),w(!1)}else w(!1),h.Am.error("پاسخ دریافتی از سرور معتبر نبود.")},B=async t=>{if(!_){h.Am.error("خطای Session. لطفاً صفحه را رفرش کنید."),w(!1);return}let s=localStorage.getItem("token");if(!s){h.Am.error("توکن منقضی شده. لطفاً دوباره وارد شوید"),e.push("/login");return}let r=R(a);if(!r||!r.chat){h.Am.error("خطای جلسه چت."),w(!1);return}try{let a=await fetch(r.chat,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({message:t,session_id:_})});if(!a.ok){if(401===a.status){h.Am.error("توکن منقضی شده. لطفاً دوباره وارد شوید"),localStorage.removeItem("token"),e.push("/login");return}throw Error("خطای سرور: ".concat(a.statusText))}let i=await a.json();Z(i)}catch(e){h.Am.error("خطا در ارسال پیام. لطفاً دوباره تلاش کنید."),w(!1)}},P=async()=>{if(!g.trim()||y||!k)return;let e={type:"user",content:g,timestamp:new Date};f(t=>[...t,e]),p(""),w(!0),await B(g)},L=async()=>{try{let t=localStorage.getItem("token");t&&await fetch("/api/auth/logout",{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/"),h.Am.success("خروج موفقیت‌آمیز بود")}catch(t){console.error("Logout error:",t),localStorage.removeItem("token"),localStorage.removeItem("user"),e.push("/"),h.Am.success("خروج انجام شد")}};return t?a?j?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/30 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white/95 backdrop-blur-xl rounded-3xl p-12 shadow-luxury border border-white/20 text-center max-w-md",children:[(0,s.jsx)("div",{className:"w-24 h-24 mx-auto mb-8 bg-gradient-to-br from-executive-navy to-executive-navy-light rounded-3xl flex items-center justify-center animate-pulse shadow-2xl",children:(0,s.jsx)(l.Z,{className:"w-12 h-12 text-white"})}),(0,s.jsx)("h2",{className:"text-3xl font-bold text-executive-charcoal mb-6",children:"در حال اتصال به سرور..."}),(0,s.jsx)("p",{className:"text-lg text-executive-ash mb-8",children:"لطفاً کمی صبر کنید"}),(0,s.jsxs)("div",{className:"flex justify-center space-x-2",children:[(0,s.jsx)("div",{className:"w-3 h-3 bg-executive-navy rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-3 h-3 bg-executive-navy rounded-full animate-bounce delay-150"}),(0,s.jsx)("div",{className:"w-3 h-3 bg-executive-navy rounded-full animate-bounce delay-300"})]})]})}):(0,s.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-executive-pearl via-white to-executive-silver/20",children:[(0,s.jsx)("header",{className:"bg-white/95 backdrop-blur-xl border-b border-executive-ash-light/30 p-3 sticky top-0 z-50 shadow-subtle",children:(0,s.jsxs)("div",{className:"flex items-center justify-between max-w-full mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>e.push("/"),className:"w-8 h-8 bg-executive-ash-light/50 rounded-lg flex items-center justify-center hover:bg-executive-navy/10 transition-all duration-300 group",children:(0,s.jsx)(c.Z,{className:"w-4 h-4 text-executive-ash group-hover:text-executive-navy"})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-executive-navy to-executive-navy-light rounded-xl flex items-center justify-center",children:(0,s.jsx)(o.Z,{className:"w-4 h-4 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-sm font-bold text-executive-charcoal",children:["جلسه تعاملی - پرسشنامه ",a]}),(0,s.jsx)("div",{className:"flex items-center gap-2 text-xs",children:S.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-1 ".concat(0===t?"text-blue-600":"text-green-600"),children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(k?0===t?"bg-blue-500":"bg-green-500":"bg-gray-400"," animate-pulse")}),(0,s.jsx)("span",{className:"font-medium",children:e})]},t))})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-executive-gold-light/20 px-3 py-1 rounded-lg border border-executive-gold/20",children:[(0,s.jsx)(d.Z,{className:"w-3 h-3 text-executive-gold"}),(0,s.jsx)("span",{className:"text-xs font-bold text-executive-charcoal",children:"امن"})]}),(0,s.jsx)(i.z,{onClick:L,variant:"outline",size:"sm",className:"bg-white/80 hover:bg-red-50 border-red-200 text-red-600 hover:text-red-700 hover:border-red-300 transition-all duration-300",children:"خروج"})]})]})}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto p-3",children:(0,s.jsxs)("div",{className:"max-w-full mx-auto space-y-3",children:[v.map((e,t)=>{var a,r;return(0,s.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"," mb-4"),children:"user"!==e.type?(0,s.jsxs)("div",{className:"flex items-start gap-2 max-w-[85%]",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-1",children:(0,s.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full overflow-hidden bg-executive-navy flex items-center justify-center text-white text-xs font-bold shadow-md",children:null!==(r=null===(a=e.character)||void 0===a?void 0:a.charAt(0).toUpperCase())&&void 0!==r?r:"A"})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[e.character&&(0,s.jsx)("span",{className:"text-xs font-semibold text-executive-charcoal bg-white/80 px-2 py-0.5 rounded-full border border-executive-ash-light/40 mb-1 self-start",children:e.character}),(0,s.jsxs)("div",{className:"rounded-2xl p-3 shadow-sm ".concat("ai1"===e.type?"bg-gradient-to-br from-blue-50 to-blue-100/60 border border-blue-200/60 rounded-bl-md":"bg-gradient-to-br from-green-50 to-green-100/60 border border-green-200/60 rounded-bl-md"),children:[(0,s.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-line text-executive-charcoal",children:e.content}),(0,s.jsx)("p",{className:"text-xs mt-1 text-executive-ash/70",children:e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})]})]}):(0,s.jsxs)("div",{className:"max-w-[85%] bg-gradient-to-br from-executive-gold/15 to-executive-gold-light/25 border border-executive-gold/30 rounded-2xl rounded-br-md p-3 shadow-sm",children:[(0,s.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-line text-executive-charcoal",children:e.content}),(0,s.jsx)("p",{className:"text-xs mt-1 text-executive-ash/70",children:e.timestamp.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})]})},t)}),y&&(0,s.jsx)("div",{className:"flex justify-start mb-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-2 max-w-[85%]",children:[(0,s.jsx)("div",{className:"w-4 h-4 flex-shrink-0 mt-1",children:(0,s.jsx)(b,{type:"ai",isTyping:!0,isSpeaking:!1})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-xs font-semibold text-executive-charcoal bg-white/80 px-2 py-0.5 rounded-full border border-executive-ash-light/40 mb-1 self-start",children:"در حال تایپ..."}),(0,s.jsx)("div",{className:"bg-white/95 border border-executive-ash-light/40 rounded-2xl rounded-bl-md p-3 shadow-sm animate-pulse",children:(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-executive-navy rounded-full animate-bounce"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-executive-navy rounded-full animate-bounce delay-150"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-executive-navy rounded-full animate-bounce delay-300"})]})})]})]})}),(0,s.jsx)("div",{ref:z})]})}),(0,s.jsx)("footer",{className:"p-3 bg-white/95 backdrop-blur-xl border-t border-executive-ash-light/30",children:(0,s.jsxs)("div",{className:"max-w-full mx-auto",children:[(0,s.jsxs)("div",{className:"flex gap-2 items-end mb-3",children:[(0,s.jsx)(n.g,{value:g,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),P())},placeholder:"پاسخ خود را بنویسید...",className:"flex-1 min-h-[60px] max-h-[120px] text-sm p-3 rounded-2xl border border-executive-ash-light/50 focus:border-executive-navy resize-none bg-white/90 backdrop-blur-sm shadow-md transition-all duration-300",disabled:y||!k}),(0,s.jsx)(i.z,{onClick:P,disabled:!g.trim()||y||!k,className:"w-12 h-12 bg-gradient-to-br from-executive-navy to-executive-navy-light hover:from-executive-navy-dark hover:to-executive-navy rounded-2xl p-0 shadow-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:transform-none",children:(0,s.jsx)(u.Z,{className:"w-5 h-5 text-white"})})]}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("p",{className:"text-xs text-executive-ash bg-executive-ash-light/20 px-3 py-2 rounded-lg inline-block",children:"\uD83D\uDCAC جلسه ارزیابی زنده"})})]})})]}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/30 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-executive-charcoal mb-4",children:"پرسشنامه انتخاب نشده"}),(0,s.jsx)("p",{className:"text-executive-ash mb-6",children:"لطفاً ابتدا یک پرسشنامه انتخاب کنید"}),(0,s.jsx)(i.z,{onClick:()=>e.push("/"),className:"bg-executive-navy text-white",children:"بازگشت به صفحه اصلی"})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-executive-pearl via-white to-executive-silver/30 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-executive-charcoal mb-4",children:"دسترسی محدود"}),(0,s.jsx)("p",{className:"text-executive-ash mb-6",children:"برای دسترسی به این صفحه باید وارد شوید"}),(0,s.jsx)(i.z,{onClick:()=>e.push("/login"),className:"bg-executive-navy text-white",children:"ورود به سیستم"})]})})}}},function(e){e.O(0,[110,332,712,112,888,774,179],function(){return e(e.s=9290)}),_N_E=e.O()}]);